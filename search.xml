<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Arduino_Bit函数</title>
      <link href="/2025/08/03/Hugo%20Blog/Arduino/Arduino_Bit%E5%87%BD%E6%95%B0/"/>
      <url>/2025/08/03/Hugo%20Blog/Arduino/Arduino_Bit%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">*bit(b)</span></span><br><span class="line"><span class="comment">*生成相应bit</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bit(b) (1 &lt;&lt; (b))</span></span><br><span class="line"><span class="comment">// 1: bit(0)</span></span><br><span class="line"><span class="comment">// 2: bit(1)</span></span><br><span class="line"><span class="comment">// 4: bit(2)</span></span><br><span class="line"><span class="comment">// 8: bit(3)</span></span><br><span class="line"><span class="comment">//16: bit(4)</span></span><br><span class="line"><span class="comment">//32: bit(5)</span></span><br><span class="line"><span class="comment">//64: bit(6)</span></span><br><span class="line"><span class="comment">//128: bit(7)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">*bitClear(x,n)</span></span><br><span class="line"><span class="comment">*x: 指定要清除位的数值</span></span><br><span class="line"><span class="comment">*n: 指定要清除位的位置，从0开始，0 表示最右端位</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bitClear(value, bit) ((value) &amp;= ~(1UL &lt;&lt; (bit)))</span></span><br><span class="line"><span class="comment">// uint8_t x = 0b11111111;</span></span><br><span class="line"><span class="comment">// x = bitClear(x,5) //0b11011111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">*bitSet(x,n)</span></span><br><span class="line"><span class="comment">*x: 想要设置的数字变量</span></span><br><span class="line"><span class="comment">*n: 想要设置的位，0是最重要（最右边）的位</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bitSet(value, bit) ((value) |= (1UL &lt;&lt; (bit)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">*bitWrite(x, n, b)</span></span><br><span class="line"><span class="comment">*x: 要写入的数值变量</span></span><br><span class="line"><span class="comment">*n: 要写入的数值变量的位，从0开始是最低（最右边）的位</span></span><br><span class="line"><span class="comment">*b: 写入位的数值（0或1）</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bitWrite(value, bit, bitvalue) (bitvalue ? bitSet(value, bit) : bitClear(value, bit))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************************</span></span><br><span class="line"><span class="comment">*bitRead(x,n)</span></span><br><span class="line"><span class="comment">*x: 想要被读取的数</span></span><br><span class="line"><span class="comment">*n: 被读取的位，0是最低有效位（最右边）</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bitRead(value, bit) (((value) &gt;&gt; (bit)) &amp; 0x01)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//取高字节</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> highByte(w) ((w) &gt;&gt; 8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//取低字节</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lowByte(w) ((w) &amp; 0xff)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arduino </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>源哥_双人成行</title>
      <link href="/2025/08/03/Hugo%20Blog/Diary/%E6%BA%90%E5%93%A5_%E5%8F%8C%E4%BA%BA%E6%88%90%E8%A1%8C/"/>
      <url>/2025/08/03/Hugo%20Blog/Diary/%E6%BA%90%E5%93%A5_%E5%8F%8C%E4%BA%BA%E6%88%90%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>周日休息, 吴浩源一家过来做客, 带了龙眼, 螺肉, 羊肚菌 过来, 真系太客气了.<br>莲姐肉眼可见的瘦了好多, 挺着大肚子的妹妹过来.源哥一来就要玩《双人成行》!<br>中午简单煲佐个汤, 下午食个豆腐卜, 又一日, 贴上照片.</p><p><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E5%90%B4%E6%B5%A9%E6%BA%90/IMG_8898.175p483pw1.webp" alt="源哥"><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E5%90%B4%E6%B5%A9%E6%BA%90/IMG_8912.7w74sz0ukm.webp" alt="源哥"><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E5%90%B4%E6%B5%A9%E6%BA%90/IMG_8940.60uk0coeyq.webp" alt="源哥"><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E5%90%B4%E6%B5%A9%E6%BA%90/IMG_8945.estmhn44j.webp" alt="源哥"></p><p>系咁先, 期待下一次嘎聚会!</p>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hi Blog</title>
      <link href="/2025/08/02/Hugo%20Blog/Hi%20Blog/"/>
      <url>/2025/08/02/Hugo%20Blog/Hi%20Blog/</url>
      
        <content type="html"><![CDATA[<p>Hi Hugo,</p><p>希望从今日起,可以开始中意记录, 爱上分享. </p><p>Best regard<br>Hugo</p>]]></content>
      
      
      <categories>
          
          <category> Hi Blog </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Arduino 串口</title>
      <link href="/2025/08/02/Hugo%20Blog/Arduino/Arduino_%E4%B8%B2%E5%8F%A3/"/>
      <url>/2025/08/02/Hugo%20Blog/Arduino/Arduino_%E4%B8%B2%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> input1 = <span class="built_in">Serial</span>.<span class="built_in">readStringUntil</span>(<span class="string">&#x27;\n&#x27;</span>);  <span class="comment">//读取输入直至换行符</span></span><br><span class="line">        input<span class="number">1.</span><span class="built_in">trim</span>(); <span class="comment">//去除多余的空格或者换行符</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(input1 == <span class="string">&quot;on&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">digitalWrite</span>(ledPin,<span class="literal">HIGH</span>);</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;LED 已打开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(input1 == <span class="string">&quot;off&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">digitalWrite</span>(ledPin,<span class="literal">LOW</span>);</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;LED 已关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;无效指令, 请输入&#x27;on&#x27;还是&#x27;off&#x27;&quot;</span>);</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="1-串口设置"><a href="#1-串口设置" class="headerlink" title="1- 串口设置"></a>1- 串口设置</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Serial</span>.<span class="built_in">end</span>();    <span class="comment">//禁止串口传输函数</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">flush</span>();    <span class="comment">//清空串口缓存</span></span><br></pre></td></tr></table></figure><h1 id="2-串口输出"><a href="#2-串口输出" class="headerlink" title="2-串口输出"></a>2-串口输出</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//val: 打印的值,任意数据类型</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(val);    <span class="comment">//串口输出函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//val: 打印的值,任意数据类型</span></span><br><span class="line"><span class="comment">//format: 输出的数据格式,包括整数类型和浮点型的小数点位数</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(val,format);</span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">78</span>,BIN);得到 <span class="string">&quot;1001110&quot;</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">78</span>, OCT) 得到 <span class="string">&quot;116&quot;</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">78</span>, DEC) 得到 <span class="string">&quot;78&quot;</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">78</span>, HEX) 得到 <span class="string">&quot;4E&quot;</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">1.23456</span>, <span class="number">0</span>) 得到 <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="number">1.23456</span>, <span class="number">2</span>) 得到 <span class="string">&quot;1.23&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出字符串数据,并换行</span></span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">println</span>(val);</span><br><span class="line"><span class="built_in">Serial</span>.<span class="built_in">println</span>(val,format);</span><br></pre></td></tr></table></figure><h1 id="3-读串口缓存区数据"><a href="#3-读串口缓存区数据" class="headerlink" title="3-读串口缓存区数据"></a>3-读串口缓存区数据</h1><h4 id="Serial-available"><a href="#Serial-available" class="headerlink" title="Serial.available();"></a>Serial.available();</h4><p>判断串口缓冲器的状态函数，用以判断数据是否送达串口。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Serial</span>.<span class="built_in">available</span>() &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="type">int</span> numdata = <span class="built_in">Serial</span>.<span class="built_in">available</span>();</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.available = :&quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(numdata);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input : test</span></span><br><span class="line"><span class="comment">//output: 4</span></span><br></pre></td></tr></table></figure><h4 id="Serial-read"><a href="#Serial-read" class="headerlink" title="Serial.read();"></a>Serial.read();</h4><p>读取串口数据，一次读一个字符，读完后删除已读数据。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> comchar;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>() &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        comchar = <span class="built_in">Serial</span>.<span class="built_in">read</span>();    <span class="comment">//读串口第一个字节</span></span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.read: &quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(comchar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input: test</span></span><br><span class="line"><span class="comment">//output: </span></span><br><span class="line"><span class="comment">//Serial.read: t</span></span><br><span class="line"><span class="comment">//Serial.read: e</span></span><br><span class="line"><span class="comment">//Serial.read: s</span></span><br><span class="line"><span class="comment">//Serial.read: t</span></span><br></pre></td></tr></table></figure><h4 id="Serial-readBytes-buffer-length"><a href="#Serial-readBytes-buffer-length" class="headerlink" title="Serial.readBytes(buffer,length);"></a>Serial.readBytes(buffer,length);</h4><p>从串口读取指定长度length的字符到缓存数组buffer。</p><p>buffer: 缓存变量</p><p>length: 设定读读取长度</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buffer[<span class="number">18</span>];</span><br><span class="line"><span class="type">int</span> numdata = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        numdata = <span class="built_in">Serial</span>.<span class="built_in">readBytes</span>(buffer,<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.readBytes:&quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">println</span>(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//clear serial buffer</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>() &gt;= <span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buffer[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input: 123abc</span></span><br><span class="line"><span class="comment">//output: Serial.readBytes: 123</span></span><br></pre></td></tr></table></figure><h4 id="Serial-readBytesUntil-character-buffer-length"><a href="#Serial-readBytesUntil-character-buffer-length" class="headerlink" title="Serial.readBytesUntil(character ,buffer,length);"></a>Serial.readBytesUntil(character ,buffer,length);</h4><p>character : 查找的字符 (char)</p><p>buffer: 存储读取数据的缓存(char[] 或byte[])</p><p>length:设定的读取长度</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buffer[<span class="number">18</span>];        </span><br><span class="line"><span class="type">char</span> character = <span class="string">&#x27;,&#x27;</span>;    <span class="comment">//终止符</span></span><br><span class="line"><span class="type">int</span> numdata = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        numdata = <span class="built_in">Serial</span>.<span class="built_in">readBytesUntil</span>(character,buffer,<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.readBytes:&quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">println</span>(numdata);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//clear serial buffer</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>() &gt;= <span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buffer[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input : 12345abc</span></span><br><span class="line"><span class="comment">//output: Serial.readBytes: 123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//input: 1,23abc</span></span><br><span class="line"><span class="comment">//output: Serial.readBytes: 1</span></span><br></pre></td></tr></table></figure><h4 id="Serial-readString-；"><a href="#Serial-readString-；" class="headerlink" title="Serial.readString()；"></a>Serial.readString()；</h4><p>从串口缓存区读取全部数据到一个字符串型变量。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> comdata = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//read data from serial port</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        comdata = <span class="built_in">Serial</span>.<span class="built_in">readString</span>();</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.readBytes:&quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">println</span>(comdata);</span><br><span class="line">    &#125;</span><br><span class="line">    comdata = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input : teststring</span></span><br><span class="line"><span class="comment">//output: Serial.readBytes:teststring</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input : test123</span></span><br><span class="line"><span class="comment">//output: Serial.readBytes:test123</span></span><br></pre></td></tr></table></figure><h4 id="Serial-readStringUntil-；"><a href="#Serial-readStringUntil-；" class="headerlink" title="Serial.readStringUntil()；"></a>Serial.readStringUntil()；</h4><p>从串口缓存区读取字符到一个字符串型变量，直至读完或遇到某终止字符。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> comdata = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">char</span> terminator = <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//read data from serial port</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        comdata = <span class="built_in">Serial</span>.<span class="built_in">readStringUntil</span>(terminator);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.readStringUntil:&quot;</span>);</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">println</span>(comdata);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>()&gt;=<span class="number">0</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input : teststring</span></span><br><span class="line"><span class="comment">//output : Serial.readStringUntil: teststring</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input : test, string</span></span><br><span class="line"><span class="comment">//output: test</span></span><br></pre></td></tr></table></figure><h4 id="Serial-parseFloat"><a href="#Serial-parseFloat" class="headerlink" title="Serial.parseFloat();"></a>Serial.parseFloat();</h4><p>读串口缓存区第一个有效的浮点型数据，数字将被跳过。当读到第一个非浮点数时函数结束。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> comfloat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// read data from serial port</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">      comfloat = <span class="built_in">Serial</span>.<span class="built_in">parseFloat</span>();</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.parseFloat:&quot;</span>);</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(comfloat);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// clear serial buffer</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>() &gt;= <span class="number">0</span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input : test123.45abc</span></span><br><span class="line"><span class="comment">//output : Serial.parseFloat:123.45</span></span><br></pre></td></tr></table></figure><h4 id="Serial-parseInt"><a href="#Serial-parseInt" class="headerlink" title="Serial.parseInt()"></a>Serial.parseInt()</h4><p>从串口接收数据流中读取第一个有效整数（包括负数）。</p><p>Serial.parseInt();</p><p>Serial.parseInt(charskipChar)    &#x2F;&#x2F;skipChar用于在搜索中跳过指定字符（此用法未知）</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> comInt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// read data from serial port</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">      comInt = <span class="built_in">Serial</span>.<span class="built_in">parseInt</span>();</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Serial.parseInt:&quot;</span>);</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(comInt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// clear serial buffer</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>() &gt;= <span class="number">0</span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//input: test123.45abc789</span></span><br><span class="line"><span class="comment">//output: Serial.parseInt: 123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//input: test-123.45abc</span></span><br><span class="line"><span class="comment">//output: Serial.parseInt: -123</span></span><br></pre></td></tr></table></figure><h4 id="Serial-find"><a href="#Serial-find" class="headerlink" title="Serial.find()"></a>Serial.find()</h4><p>从串口缓存区读取数据，寻找目标字符串target(char型)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> target[] = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// read data from serial port</span></span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">Serial</span>.<span class="built_in">available</span>()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">if</span>( <span class="built_in">Serial</span>.<span class="built_in">find</span>(target))&#123;</span><br><span class="line">         <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;find traget:&quot;</span>);</span><br><span class="line">         <span class="built_in">Serial</span>.<span class="built_in">println</span>(target);       </span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="comment">// clear serial buffer</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Serial</span>.<span class="built_in">read</span>() &gt;= <span class="number">0</span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input : adfadf1123etest12e</span></span><br><span class="line"><span class="comment">//output: find traget: test</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arduino </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo指令</title>
      <link href="/2025/07/31/Hugo%20Blog/Hexo/Hexo%E6%8C%87%E4%BB%A4/"/>
      <url>/2025/07/31/Hugo%20Blog/Hexo/Hexo%E6%8C%87%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>输入下面代码, 下载hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure><p>输入下面代码, 启动hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>成功启动后，你会在终端上看到一个地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:4000/</span><br></pre></td></tr></table></figure><h1 id="本地编辑笔记"><a href="#本地编辑笔记" class="headerlink" title="本地编辑笔记"></a>本地编辑笔记</h1><ol><li>导出markdown文件</li><li>存放至Hexo文件夹中&#x3D;&#x3D;Source&#x3D;&#x3D; 的&#x3D;&#x3D;posts&#x3D;&#x3D;子文件夹中</li></ol><p><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/20250731/%E6%88%AA%E5%B1%8F2025-07-31-20.50.07.6iklkpjgwz.webp" alt="文件地址.png"></p><ol start="3"><li><p>然后复制一下Hexo文件的地址<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/20250731/%E6%88%AA%E5%B1%8F2025-07-31-21.02.39.3gopjhx3nc.webp" alt="Hexo文件地址.png"></p></li><li><p>打开终端, 输入cd, 然后黏贴刚才的Hexo的地址</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/hugochen/Hugo/Hexo</span><br></pre></td></tr></table></figure><ol start="3"><li>依次使用下面的几个命令</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><ol start="4"><li>这个命令能让你将 Markdown 文件转化为可供阅读的静态网页</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><ol start="5"><li><p>然后会看到这个地址: <a href="http://localhost:4000/">http://localhost:4000/</a><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/20250731/%E6%88%AA%E5%B1%8F2025-07-31-21.07.15.45zp4ma7x.webp" alt="本地地址.png"></p></li><li><p>在浏览器中,输入此地址: <a href="http://localhost:4000/">http://localhost:4000/</a></p></li></ol><h1 id="将Hexo部署至Giuhub"><a href="#将Hexo部署至Giuhub" class="headerlink" title="将Hexo部署至Giuhub"></a>将Hexo部署至Giuhub</h1><ol><li><p>在github上创建1个仓库,命名注意需要跟用户名一致: <code>Hugochenseed.github.io</code><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/20250731/%E6%88%AA%E5%B1%8F2025-07-31-21.51.21.4n80s5e6ut.webp" alt="github建hexo仓库.png"></p></li><li><p>将 deploy 后面的代码，按照我的格式进行修改, 然后保存退出</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line"></span><br><span class="line">type: git</span><br><span class="line"></span><br><span class="line">repo: https://github.com/Hugochenseed/Hugochenseed.github.io</span><br><span class="line"></span><br><span class="line">branch: main</span><br></pre></td></tr></table></figure><ol start="3"><li>回到终端, 依次执行以下命令,就可以推送至github仓库了</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>或者直接执行这3个指令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server &amp;&amp; hexo generate &amp;&amp; hexo server</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>沙湖2日游</title>
      <link href="/2025/07/26/Hugo%20Blog/Diary/%E6%B2%99%E6%B9%962%E6%97%A5%E6%B8%B8/"/>
      <url>/2025/07/26/Hugo%20Blog/Diary/%E6%B2%99%E6%B9%962%E6%97%A5%E6%B8%B8/</url>
      
        <content type="html"><![CDATA[<h1 id="雯雯幼儿园毕业晚会"><a href="#雯雯幼儿园毕业晚会" class="headerlink" title="雯雯幼儿园毕业晚会"></a>雯雯幼儿园毕业晚会</h1><ul><li>C位跳舞, 速看照片<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0090.45zrnq2gm.webp" alt="雯雯跳舞.png"></li></ul><p>雯雯: “我幼儿园毕业啦!”<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0058.9kghoh9b6x.webp" alt="毕业照"></p><p>当然也有莹莹的在幼儿园里的玩耍<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0061.54y2j7wwz3.webp" alt="莹莹.png"></p><p>第二天: 7&#x2F;27</p><ul><li><p>一起喝奶茶, 她们已经不喜欢和牛奶口味啦,要和奶茶口味!<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0180.175p2jlwck.webp" alt="喝奶茶"></p></li><li><p>公园里玩耍<br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0200.7w74raj11r.webp" alt="公园玩耍.png"><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0205.6wr1e4g9w9.webp" alt="公园玩耍.png"><br><img src="https://github.com/Hugochenseed/picx-images-hosting/raw/master/%E9%9B%AF%E9%9B%AF%E8%8E%B9%E8%8E%B9%E4%BE%9D%E8%8E%B9/IMG_0209.54y2j7wx0j.webp" alt="公园玩耍.png"></p></li><li><p>期待下一次再见👋, 拜拜啰!</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Diary </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Arduino _字符函数</title>
      <link href="/2025/06/22/Hugo%20Blog/Arduino/Arduino%20_%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0/"/>
      <url>/2025/06/22/Hugo%20Blog/Arduino/Arduino%20_%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Arduino-字符函数"><a href="#Arduino-字符函数" class="headerlink" title="Arduino 字符函数"></a>Arduino 字符函数</h1><h2 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myString.<span class="built_in">substring</span>(from)<span class="comment">//从开始</span></span><br><span class="line">myString.<span class="built_in">substring</span>(from, to)<span class="comment">//第一个参数int为开始的索引，对应String数字中的开始位置;第二个参数是截止的索引位置，对应String中的结束位置</span></span><br></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  <span class="type">String</span> str = <span class="string">&quot;perseverance&quot;</span>;</span><br><span class="line">  <span class="type">String</span> str0 = str.<span class="built_in">substring</span>(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">//（从起始点截取某个长度的字符串）</span></span><br><span class="line">  <span class="type">String</span> str1 = str.<span class="built_in">substring</span>(<span class="number">3</span>);<span class="comment">//从第3个数开始一直都末尾</span></span><br><span class="line">  <span class="type">String</span> str2 = str.<span class="built_in">substring</span>(<span class="number">5</span>, <span class="number">10</span>);<span class="comment">//从第5个数开始到10个数</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;str0= %s , str1 = %s  , str2= %s \n&quot;</span>, str<span class="number">0.</span><span class="built_in">c_str</span>(), str<span class="number">1.</span><span class="built_in">c_str</span>(), str<span class="number">2.</span><span class="built_in">c_str</span>());</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arduino </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD检测——笔记2</title>
      <link href="/2023/03/19/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/AD%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B02/"/>
      <url>/2023/03/19/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/AD%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B02/</url>
      
        <content type="html"><![CDATA[<h1 id="AD检测——笔记2"><a href="#AD检测——笔记2" class="headerlink" title="AD检测——笔记2"></a>AD检测——笔记2</h1><p>1.衔接上笔记1,通常情况下，在2ms处，使用AD检测函数，但是AD检测函数一般是需要等待的，为了消除这个等待时间，这里利用定时器125us的空挡，来代替这个等待时间。相当于优化了这个AD检测。</p><p>框架如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Init_Ad();    <span class="comment">//AD初始化</span></span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_sys_2ms)</span><br><span class="line">    &#123;</span><br><span class="line">        b_sys_2ms = <span class="number">0</span>;</span><br><span class="line">        Ad_Waitting();    <span class="comment">//AD等待函数</span></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//125us中断函数</span></span><br><span class="line">DEFINE_ISR (Interrupt_Extemal, <span class="number">0x14</span>) <span class="comment">//CTM0 A</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">     Ad_Read();    <span class="comment">//AD读取</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AD等待函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __ADC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __ADC_H__</span></span><br><span class="line"></span><br><span class="line">uint Loop_Arr,</span><br><span class="line">Temp_main2,</span><br><span class="line">Ad_data,</span><br><span class="line">Loop_Arr,</span><br><span class="line">Temper</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">bit b_CanRead_AD,</span><br><span class="line">b_Adc</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Ad_Waiting</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Ad_Readd</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Get_Temper</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;def.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Adc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> Tab_temp_array[]=&#123;</span><br><span class="line">    <span class="number">13</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">17</span>,    <span class="comment">//0~9F</span></span><br><span class="line">    <span class="number">18</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">22</span>,    <span class="comment">//10~19F</span></span><br><span class="line">    <span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,    <span class="comment">//20F~29F    </span></span><br><span class="line">    <span class="number">32</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">40</span>,    <span class="comment">//30~39F</span></span><br><span class="line">    <span class="number">42</span>,<span class="number">43</span>,<span class="number">44</span>,<span class="number">45</span>,<span class="number">46</span>,<span class="number">47</span>,<span class="number">48</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">53</span>,    <span class="comment">//40~49F</span></span><br><span class="line">    <span class="number">55</span>,<span class="number">56</span>,<span class="number">57</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">63</span>,<span class="number">65</span>,<span class="number">67</span>,<span class="number">69</span>,<span class="number">71</span>,    <span class="comment">//50F~59F</span></span><br><span class="line">    <span class="number">72</span>,<span class="number">73</span>,<span class="number">74</span>,<span class="number">76</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">83</span>,<span class="number">85</span>,<span class="number">87</span>,<span class="number">89</span>,    <span class="comment">//60~69F</span></span><br><span class="line">    <span class="number">92</span>,<span class="number">95</span>,<span class="number">97</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">105</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">114</span>,    <span class="comment">//70~79F</span></span><br><span class="line">    <span class="number">117</span>,<span class="number">119</span>,<span class="number">122</span>,<span class="number">125</span>,<span class="number">127</span>,<span class="number">130</span>,<span class="number">135</span>,<span class="number">138</span>,<span class="number">141</span>,<span class="number">144</span>,    <span class="comment">//80~89F</span></span><br><span class="line">    <span class="number">147</span>,<span class="number">150</span>,<span class="number">153</span>,<span class="number">156</span>,<span class="number">160</span>,<span class="number">163</span>,<span class="number">166</span>,<span class="number">170</span>,<span class="number">173</span>,<span class="number">179</span>,    <span class="comment">//90~99F</span></span><br><span class="line">    <span class="number">181</span>,<span class="number">183</span>,<span class="number">190</span>,<span class="number">195</span>,<span class="number">198</span>,<span class="number">201</span>,<span class="number">206</span>,<span class="number">210</span>,<span class="number">214</span>,<span class="number">222</span>,    <span class="comment">//100~109F</span></span><br><span class="line">    <span class="number">227</span>,<span class="number">230</span>,<span class="number">234</span>,<span class="number">239</span>,<span class="number">244</span>,<span class="number">248</span>,<span class="number">252</span>,<span class="number">257</span>,<span class="number">267</span>,<span class="number">271</span>,    <span class="comment">//110~119F</span></span><br><span class="line">    <span class="number">276</span>,<span class="number">280</span>,<span class="number">287</span>,<span class="number">292</span>,<span class="number">297</span>,<span class="number">303</span>,<span class="number">308</span>,<span class="number">318</span>,<span class="number">324</span>,<span class="number">330</span>,    <span class="comment">//120~129F</span></span><br><span class="line">    <span class="number">336</span>,<span class="number">341</span>,<span class="number">347</span>,<span class="number">353</span>,<span class="number">358</span>,<span class="number">365</span>,<span class="number">377</span>,<span class="number">387</span>,<span class="number">390</span>,<span class="number">397</span>,    <span class="comment">//130~139F</span></span><br><span class="line">    <span class="number">403</span>,<span class="number">410</span>,<span class="number">417</span>,<span class="number">423</span>,<span class="number">430</span>,<span class="number">444</span>,<span class="number">451</span>,<span class="number">459</span>,<span class="number">463</span>,<span class="number">473</span>,    <span class="comment">//140~149F</span></span><br><span class="line">    <span class="number">480</span>,<span class="number">488</span>,<span class="number">495</span>,<span class="number">504</span>,<span class="number">519</span>,<span class="number">527</span>,<span class="number">535</span>,<span class="number">542</span>,<span class="number">552</span>,<span class="number">560</span>,    <span class="comment">//150~159F</span></span><br><span class="line">    <span class="number">568</span>,<span class="number">576</span>,<span class="number">585</span>,<span class="number">603</span>,<span class="number">614</span>,<span class="number">620</span>,<span class="number">629</span>,<span class="number">638</span>,<span class="number">648</span>,<span class="number">656</span>,    <span class="comment">//160~169F</span></span><br><span class="line">    <span class="number">675</span>,<span class="number">685</span>,<span class="number">694</span>,<span class="number">703</span>,<span class="number">713</span>,<span class="number">723</span>,<span class="number">733</span>,<span class="number">743</span>,<span class="number">753</span>,<span class="number">763</span>,    <span class="comment">//170~179F</span></span><br><span class="line">    <span class="number">773</span>,<span class="number">794</span>,<span class="number">805</span>,<span class="number">815</span>,<span class="number">825</span>,<span class="number">836</span>,<span class="number">846</span>,<span class="number">858</span>,<span class="number">868</span>,<span class="number">879</span>,    <span class="comment">//180~189F</span></span><br><span class="line">    <span class="number">901</span>,<span class="number">912</span>,<span class="number">924</span>,<span class="number">936</span>,<span class="number">947</span>,<span class="number">960</span>,<span class="number">970</span>,<span class="number">984</span>,<span class="number">994</span>,<span class="number">1016</span>,    <span class="comment">//190~199F</span></span><br><span class="line">    <span class="number">1028</span>,<span class="number">1040</span>,<span class="number">1052</span>,<span class="number">1064</span>,<span class="number">1075</span>,<span class="number">1088</span>,<span class="number">1004</span>,<span class="number">1020</span>,<span class="number">1137</span>,<span class="number">1150</span>,    <span class="comment">//200~209F</span></span><br><span class="line">    <span class="number">1162</span>,<span class="number">1173</span>,<span class="number">1188</span>,<span class="number">1199</span>,<span class="number">1214</span>,<span class="number">1238</span>,<span class="number">1249</span>,<span class="number">1264</span>,<span class="number">1277</span>,<span class="number">1290</span>,    <span class="comment">//210~219F</span></span><br><span class="line">    <span class="number">1298</span>,<span class="number">1316</span>,<span class="number">1342</span>,<span class="number">1356</span>,<span class="number">1369</span>,<span class="number">1381</span>,<span class="number">1395</span>,<span class="number">1410</span>,<span class="number">1422</span>,<span class="number">1432</span>,    <span class="comment">//220~229F</span></span><br><span class="line">    <span class="number">1449</span>,<span class="number">1476</span>,<span class="number">1489</span>,<span class="number">1500</span>,<span class="number">1515</span>,<span class="number">1530</span>,<span class="number">1445</span>,<span class="number">1557</span>,<span class="number">1468</span>,<span class="number">1584</span>,    <span class="comment">//230~239F</span></span><br><span class="line">    <span class="number">1611</span>,<span class="number">1625</span>,<span class="number">1638</span>,<span class="number">1651</span>,<span class="number">1666</span>,<span class="number">1679</span>,<span class="number">1693</span>,<span class="number">1704</span>,<span class="number">1720</span>,<span class="number">1735</span>,    <span class="comment">//240~249F</span></span><br><span class="line">    <span class="number">1748</span>,<span class="number">1765</span>,<span class="number">1778</span>,<span class="number">1802</span>,<span class="number">1817</span>,<span class="number">1830</span>,<span class="number">1845</span>,<span class="number">1857</span>,<span class="number">1868</span>,<span class="number">1886</span>,    <span class="comment">//250~259F</span></span><br><span class="line">    <span class="number">1911</span>,<span class="number">1925</span>,<span class="number">1938</span>,<span class="number">1950</span>,<span class="number">1965</span>,<span class="number">1977</span>,<span class="number">1992</span>,<span class="number">2010</span>,<span class="number">2019</span>,<span class="number">2038</span>,    <span class="comment">//260~269F</span></span><br><span class="line">    <span class="number">2048</span>,<span class="number">2072</span>,<span class="number">2084</span>,<span class="number">2099</span>,<span class="number">2110</span>,<span class="number">2125</span>,<span class="number">2140</span>,<span class="number">2151</span>,<span class="number">2163</span>,<span class="number">2178</span>,    <span class="comment">//270~279F</span></span><br><span class="line">    <span class="number">2203</span>,<span class="number">2216</span>,<span class="number">2229</span>,<span class="number">2242</span>,<span class="number">2255</span>,<span class="number">2279</span>,<span class="number">2280</span>,<span class="number">2295</span>,<span class="number">2310</span>,<span class="number">2330</span>,    <span class="comment">//280~289F</span></span><br><span class="line">    <span class="number">2345</span>,<span class="number">2356</span>,<span class="number">2369</span>,<span class="number">2380</span>,<span class="number">2397</span>,<span class="number">2405</span>,<span class="number">2419</span>,<span class="number">2433</span>,<span class="number">2450</span>,<span class="number">2468</span>,     <span class="comment">//290~299F</span></span><br><span class="line">    <span class="number">2477</span>,<span class="number">2489</span>,<span class="number">2501</span>,<span class="number">2513</span>,<span class="number">2524</span>,<span class="number">2435</span>,<span class="number">2547</span>,<span class="number">2570</span>,<span class="number">2482</span>,<span class="number">2593</span>,     <span class="comment">//300~309F</span></span><br><span class="line">    <span class="number">2506</span>,<span class="number">2615</span>,<span class="number">2627</span>,<span class="number">2638</span>,<span class="number">2649</span>,<span class="number">2660</span>,<span class="number">2682</span>,<span class="number">2693</span>,<span class="number">2703</span>,<span class="number">2713</span>,    <span class="comment">//310~319F</span></span><br><span class="line">    <span class="number">2724</span>,<span class="number">2735</span>,<span class="number">2746</span>,<span class="number">2756</span>,<span class="number">2766</span>,<span class="number">2787</span>,<span class="number">2797</span>,<span class="number">2807</span>,<span class="number">2817</span>,<span class="number">2827</span>,    <span class="comment">//320~329F</span></span><br><span class="line">    <span class="number">2837</span>,<span class="number">2847</span>,<span class="number">2857</span>,<span class="number">2867</span>,<span class="number">2886</span>,<span class="number">2897</span>,<span class="number">2905</span>,<span class="number">2914</span>,<span class="number">2924</span>,<span class="number">2933</span>,    <span class="comment">//330~339F</span></span><br><span class="line">    <span class="number">2942</span>,<span class="number">2951</span>,<span class="number">2961</span>,<span class="number">2979</span>,<span class="number">2988</span>,<span class="number">2997</span>,<span class="number">3002</span>,<span class="number">3014</span>,<span class="number">3022</span>,<span class="number">3032</span>,    <span class="comment">//340~349F    </span></span><br><span class="line">    <span class="number">3040</span>,<span class="number">3049</span>,<span class="number">3065</span>,<span class="number">3073</span>,<span class="number">3082</span>,<span class="number">3090</span>,<span class="number">3098</span>,<span class="number">3007</span>,<span class="number">3114</span>,<span class="number">3125</span>,    <span class="comment">//350~359F</span></span><br><span class="line">    <span class="number">3130</span>,<span class="number">3146</span>,<span class="number">3154</span>,<span class="number">3161</span>,<span class="number">3168</span>,<span class="number">3176</span>,<span class="number">3184</span>,<span class="number">3191</span>,<span class="number">3198</span>,<span class="number">3206</span>,    <span class="comment">//360~369F    </span></span><br><span class="line">    <span class="number">3220</span>,<span class="number">3228</span>,<span class="number">3235</span>,<span class="number">3241</span>,<span class="number">3249</span>,<span class="number">3256</span>,<span class="number">3262</span>,<span class="number">3269</span>,<span class="number">3276</span>,<span class="number">3289</span>,    <span class="comment">//370~379F    </span></span><br><span class="line">    <span class="number">3296</span>,<span class="number">3303</span>,<span class="number">3309</span>,<span class="number">3315</span>,<span class="number">3322</span>,<span class="number">3328</span>,<span class="number">3336</span>,<span class="number">3341</span>,<span class="number">3353</span>,<span class="number">3359</span>,    <span class="comment">//380~389F</span></span><br><span class="line">    <span class="number">3365</span>,<span class="number">3371</span>,<span class="number">3377</span>,<span class="number">3382</span>,<span class="number">3389</span>,<span class="number">3395</span>,<span class="number">3400</span>,<span class="number">3412</span>,<span class="number">3417</span>,<span class="number">3423</span>,    <span class="comment">//390~399F</span></span><br><span class="line">    <span class="number">3429</span>,<span class="number">3434</span>,<span class="number">3439</span>,<span class="number">3444</span>,<span class="number">3449</span>,<span class="number">3455</span>,<span class="number">3466</span>,<span class="number">3471</span>,<span class="number">3476</span>,<span class="number">3481</span>,    <span class="comment">//400~409F</span></span><br><span class="line">    <span class="number">3486</span>,<span class="number">3491</span>,<span class="number">3496</span>,<span class="number">3500</span>,<span class="number">3505</span>,<span class="number">3515</span>,<span class="number">3520</span>,<span class="number">3524</span>,<span class="number">3529</span>,<span class="number">3534</span>,    <span class="comment">//410~419F</span></span><br><span class="line">    <span class="number">3539</span>,<span class="number">3543</span>,<span class="number">3548</span>,<span class="number">3551</span>,<span class="number">3560</span>,<span class="number">3564</span>,<span class="number">3569</span>,<span class="number">3574</span>,<span class="number">3577</span>,<span class="number">3582</span>,    <span class="comment">//420~429F</span></span><br><span class="line">    <span class="number">3586</span>,<span class="number">3590</span>,<span class="number">3594</span>,<span class="number">3602</span>,<span class="number">3606</span>,<span class="number">3610</span>,<span class="number">3614</span>,<span class="number">3617</span>,<span class="number">3621</span>,<span class="number">3625</span>,    <span class="comment">//430~439F</span></span><br><span class="line">    <span class="number">3629</span>,<span class="number">3633</span>,<span class="number">3640</span>,<span class="number">3644</span>,<span class="number">3647</span>,<span class="number">3650</span>,<span class="number">3654</span>,<span class="number">3658</span>,<span class="number">3661</span>,<span class="number">3665</span>,    <span class="comment">//440~449F</span></span><br><span class="line">    <span class="number">3668</span>,<span class="number">3675</span>,<span class="number">3678</span>,<span class="number">3681</span>,<span class="number">3685</span>,<span class="number">3688</span>,<span class="number">3691</span>,<span class="number">3694</span>,<span class="number">3698</span>,<span class="number">3701</span>,    <span class="comment">//450~459F</span></span><br><span class="line">    <span class="number">3707</span>,<span class="number">3707</span>,</span><br><span class="line">    &#125;;    <span class="comment">//460F</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">functio:ADC等待</span></span><br><span class="line"><span class="comment">input: </span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Ad_Waiting</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> uint mainh,main_temp0;</span><br><span class="line">    <span class="type">static</span> uint TEMP_BK,Temp_delay;</span><br><span class="line">    <span class="type">static</span> uchar Ad_cnt,maincnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_CanRead_AD) <span class="keyword">return</span>;        <span class="comment">//没有读完</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取AD温度</span></span><br><span class="line">    mainh += Ad_data;</span><br><span class="line">    <span class="keyword">if</span>(++maincnt &gt;= <span class="number">16</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        maincnt = <span class="number">0</span>;</span><br><span class="line">        mainh &gt;&gt;= <span class="number">4</span>;</span><br><span class="line">        main_temp0 = <span class="number">0x0fff</span> - mainh;</span><br><span class="line">        mainh = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取值范围</span></span><br><span class="line">        <span class="keyword">if</span>(main_temp0 &gt;= <span class="number">0x0ff0</span>) main_temp0 = <span class="number">0x0ff0</span>;</span><br><span class="line">        <span class="keyword">if</span>(main_temp0 &lt; <span class="number">32</span>) main_temp0 = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消抖</span></span><br><span class="line">        <span class="keyword">if</span>(main_temp0 &lt; <span class="number">150</span>)  Temp_delay = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(main_temp0 &lt; <span class="number">318</span>) Temp_delay = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(main_temp0 &lt; <span class="number">773</span>) Temp_delay = <span class="number">9</span>;    </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(main_temp0 &lt; <span class="number">2827</span>) Temp_delay = <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(main_temp0 &lt; <span class="number">3486</span>) Temp_delay = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">else</span> Temp_delay = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>((main_temp0 &gt;= TEMP_BK + Temp_delay) || (main_temp0 &lt;= TEMP_BK - Temp_delay))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(++Ad_cnt &gt;= <span class="number">8</span>)    <span class="comment">//消抖次数</span></span><br><span class="line">            &#123;</span><br><span class="line">                    Ad_cnt = <span class="number">0</span>;</span><br><span class="line">                    TEMP_BK = main_temp0;</span><br><span class="line">                    Temp_main2 = main_temp0;        <span class="comment">//获取AD值</span></span><br><span class="line">                    b_Adc = <span class="number">1</span>;        <span class="comment">//</span></span><br><span class="line">                    Loop_Arr = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;Ad_cnt = <span class="number">0</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动AD检测</span></span><br><span class="line">    _adcr0 = _ADC_CH1;</span><br><span class="line">    _start = <span class="number">0</span>;</span><br><span class="line">    GCC_NOP();</span><br><span class="line">    _start = <span class="number">1</span>;</span><br><span class="line">    GCC_NOP();</span><br><span class="line">    _start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    b_CanRead_AD = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">functio:ADC读取</span></span><br><span class="line"><span class="comment">input: </span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Ad_Readd</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uint main_12 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_CanRead_AD)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!_adbz)</span><br><span class="line">        &#123;</span><br><span class="line">            main_12 = _adrh;    <span class="comment">//00000000 0000xxxx</span></span><br><span class="line">            main_12 &lt;&lt;= <span class="number">8</span>;        <span class="comment">//0000xxxx 00000000</span></span><br><span class="line">            main_12 &amp;= <span class="number">0xff00</span>;</span><br><span class="line">            main_12 |= _adrl;    <span class="comment">//0000xxxx xxxxxxxx</span></span><br><span class="line">            Ad_data = main_12;    </span><br><span class="line">            b_CanRead_AD = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:void Get_Temper()</span></span><br><span class="line"><span class="comment">输入:</span></span><br><span class="line"><span class="comment">输出:Temper</span></span><br><span class="line"><span class="comment">函数功能：将12位AD值，转化成华氏度(F)</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Get_Temper</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    <span class="comment">//获取AD完毕</span></span><br><span class="line">    <span class="keyword">if</span>(b_Adc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Temp_main2 &gt;= <span class="number">3707</span>) &#123;Temper = <span class="number">460</span>;b_Adc = <span class="number">0</span>;&#125;        <span class="comment">//短路,显示460F</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Temp_main2 &lt;= <span class="number">20</span>) &#123;Temper = <span class="number">20</span>;b_Adc = <span class="number">0</span>;&#125;    <span class="comment">//开路,显示20F</span></span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt;= <span class="number">20</span>;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Temp_main2 &lt;= Tab_temp_array[Loop_Arr])    </span><br><span class="line">                &#123;</span><br><span class="line">                        Temper = Loop_Arr;</span><br><span class="line">                        Loop_Arr = <span class="number">460</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++Loop_Arr &gt;= <span class="number">461</span>)    <span class="comment">//超过表格</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(Loop_Arr &gt;= <span class="number">460</span>) &#123;b_Adc = <span class="number">0</span>;&#125;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高原检测</title>
      <link href="/2023/03/19/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E9%AB%98%E5%8E%9F%E6%A3%80%E6%B5%8B/"/>
      <url>/2023/03/19/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E9%AB%98%E5%8E%9F%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="高原检测"><a href="#高原检测" class="headerlink" title="高原检测"></a>高原检测</h1><h2 id="HW高原检测"><a href="#HW高原检测" class="headerlink" title="HW高原检测"></a>HW高原检测</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _ChkPlateau_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _ChkPlateau_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_Chk_on     p_heat_rly</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AD_cp_min         0xab        <span class="comment">//171--80C</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AD_cp_start     0xb2        <span class="comment">//178--85C</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CP_tim_S     15            <span class="comment">//--n*S</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CP_tim_M     25            <span class="comment">//-n*S</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CP_tim_L     30            <span class="comment">//--n*S</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;..\SourceFile\ChkPlateau.h&quot;</span></span></span><br><span class="line"><span class="comment">/**********************************</span></span><br><span class="line"><span class="comment">************检测高原**************</span></span><br><span class="line"><span class="comment">***************500MS************/</span></span><br><span class="line"><span class="comment">//CP_AD:实际AD   CP_temp:实际温度</span></span><br><span class="line"><span class="comment">//high_temp:得出的高原温度</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ChkPlateau</span><span class="params">(uchar CP_AD,uchar CP_temp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> uchar up_temp,AD_last,h_tjs;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span>(b_Chk_on &amp;&amp; (CP_AD &gt; AD_cp_min) &amp;&amp; !high_temp)    <span class="comment">//加热中 &amp;&amp; AD&gt;Min &amp;&amp; 未进高原</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(CP_AD &lt; AD_cp_start) &#123;h_tjs = <span class="number">0</span>;&#125;        <span class="comment">//低于85度,重新计算</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(CP_AD &gt;= (AD_last + <span class="number">2</span>))        <span class="comment">//上升2个AD</span></span><br><span class="line">        &#123;</span><br><span class="line">            up_temp++;</span><br><span class="line">            AD_last = CP_AD;    <span class="comment">//刷新AD</span></span><br><span class="line">            h_tjs = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(CP_AD &lt;= (AD_last - <span class="number">2</span>))    <span class="comment">//下降2个AD</span></span><br><span class="line">        &#123;</span><br><span class="line">            up_temp = <span class="number">0</span>;</span><br><span class="line">            AD_last = CP_AD;    <span class="comment">//刷新AD</span></span><br><span class="line">            h_tjs = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>    <span class="comment">//变化2个AD以内的</span></span><br><span class="line">        &#123;</span><br><span class="line">          h_tjs++;</span><br><span class="line">          <span class="keyword">if</span>(up_temp &gt;= <span class="number">4</span>)    <span class="comment">//上升超过4次</span></span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span>(h_tjs &gt;= CP_tim_S*<span class="number">2</span>) &#123;high_temp = CP_temp;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span>(up_temp &gt;= <span class="number">2</span>)    <span class="comment">//上升超过2次</span></span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span>(h_tjs &gt;= CP_tim_M*<span class="number">2</span>) &#123;high_temp = CP_temp;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> </span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span>(h_tjs &gt;= CP_tim_L*<span class="number">2</span>) &#123;high_temp = CP_temp;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        h_tjs = <span class="number">0</span>;</span><br><span class="line">        up_temp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>凯翔的高原检测</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">xdata   u16     Boiling_Time;</span><br><span class="line">xdata   u16     Del_24S_Judg;</span><br><span class="line">xdata   u8      Last_Heat_Water_Temp;</span><br><span class="line"><span class="comment">//============================================</span></span><br><span class="line"><span class="comment">//高原检测</span></span><br><span class="line"><span class="comment">//返回1:高原或者水已开</span></span><br><span class="line"><span class="comment">//返回0:没有水开</span></span><br><span class="line"><span class="comment">//============================================</span></span><br><span class="line">u8 <span class="title function_">Judg_Boilling</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> u16 Base = <span class="number">0</span>;</span><br><span class="line">    u16 Set_Adc = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//小于85度,使用600W</span></span><br><span class="line">    <span class="keyword">if</span>(Temper &lt; <span class="number">85</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Set_Power = Power_600W;</span><br><span class="line">        Last_Heat_Water_Temp = Temper;        <span class="comment">//刷新温度</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        Set_Power = Set_Judg_Power;            <span class="comment">//85度后的加热功率    </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Fun_Res = 1的时候,加热中</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> == Fun_Res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Temper &lt;= Last_Heat_Water_Temp - <span class="number">5</span>)    <span class="comment">//下降5度,中途加水</span></span><br><span class="line">        &#123;</span><br><span class="line">            Last_Heat_Water_Temp = Temper;</span><br><span class="line">            Del_24S_Judg=<span class="number">0</span>;<span class="comment">//高原计数清0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Temper &gt; Last_Heat_Water_Temp)        <span class="comment">//温度上升</span></span><br><span class="line">            &#123;Last_Heat_Water_Temp = Temper;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2400秒后开始检测高原</span></span><br><span class="line">    <span class="keyword">if</span>(Del_24S_Judg &lt; <span class="number">2400</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ++Del_24S_Judg;</span><br><span class="line">        Boilling_Time = <span class="number">0</span>;</span><br><span class="line">        LastJudgAdc = Save_Adc;        <span class="comment">//记录24秒后的AD</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//温度大于97度,水开,不需要检测高原</span></span><br><span class="line">    <span class="keyword">if</span>(Temper &gt;= <span class="number">97</span>)    <span class="keyword">return</span> <span class="number">1</span>;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//AD下降或不变</span></span><br><span class="line">    <span class="keyword">if</span>(Save_Adc &lt;= LastJudgAdc)</span><br><span class="line">        &#123;Base = LastJudgAdc - Save_Adc;&#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        LastJudgAdc = Save_Adc;</span><br><span class="line">        Boiling_Time = <span class="number">0</span>;</span><br><span class="line">        Base = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set_Judg_Adc = 20, 温度保持在0~20个AD以内</span></span><br><span class="line">    <span class="keyword">if</span>(Base &lt;= Set_Judg_Adc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(++Boilling_Time &gt;= Set_Judg_Time)    <span class="comment">//12s - 30s</span></span><br><span class="line">        &#123;</span><br><span class="line">            Boilling_Time = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//温度上升期间</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span> == Fun_Res)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Boilling_Time &gt;= <span class="number">1200</span>)    <span class="comment">//上升缓慢</span></span><br><span class="line">                Boilling_Time &gt;&gt;= <span class="number">1</span>;    <span class="comment">//考虑见减少6秒时间判断高原</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                Boilling_Time = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            Boilling_Time = <span class="number">0</span>;</span><br><span class="line">        LastJudgAdc = Save_Adc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>I/O口模拟SPI通信协议</title>
      <link href="/2023/03/14/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/IO%E5%8F%A3%E6%A8%A1%E6%8B%9FSPI%E5%8D%8F%E8%AE%AE/"/>
      <url>/2023/03/14/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/IO%E5%8F%A3%E6%A8%A1%E6%8B%9FSPI%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="I-O口模拟SPI通信协议"><a href="#I-O口模拟SPI通信协议" class="headerlink" title="I&#x2F;O口模拟SPI通信协议"></a>I&#x2F;O口模拟SPI通信协议</h1><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>在芯片的资料上，有两个非常特殊的寄存器配置位，分别是 CPOL （Clock POlarity）和 CPHA （Clock PHAse）。</p><p>CPOL配置SPI总线的极性;</p><p>CPHA配置SPI总线的相位;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPOL = <span class="number">1</span>：表示空闲时是高电平</span><br><span class="line">CPOL = <span class="number">0</span>：表示空闲时是低电平</span><br></pre></td></tr></table></figure><p>由于数据传输往往是从跳变沿开始的，也就表示开始传输数据的时候，是下降沿还是上升沿</p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/SPI总线图1 .png" ><h1 id="SPI总线的相位"><a href="#SPI总线的相位" class="headerlink" title="SPI总线的相位"></a>SPI总线的相位</h1><p>个时钟周期会有2个跳变沿。而相位，直接决定SPI总线从那个跳变沿开始采样数据。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPHA = <span class="number">0</span>：表示从第一个跳变沿开始采样</span><br><span class="line">CPHA = <span class="number">1</span>：表示从第二个跳变沿开始采样</span><br></pre></td></tr></table></figure><p><img src="D:\有道云笔记图\SPI总线图\SPI总线图2.png"></p><p>至于跳变沿究竟是上升沿还是下降沿，这取决于 CPOL。记住， CPHA 只决定是哪个跳变沿采样。</p><h1 id="4种模式"><a href="#4种模式" class="headerlink" title="4种模式"></a>4种模式</h1><p>CPOL 和 CPHA 的不同组合，形成了SPI总线的不同模式。</p><table><thead><tr><th align="center">mode</th><th align="center">CPOL</th><th align="center">CPHA</th></tr></thead><tbody><tr><td align="center">mode0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">mode1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">mode2</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">mode3</td><td align="center">1</td><td align="center">1</td></tr></tbody></table><h2 id="模式0-CPOL-0-CPHA-0"><a href="#模式0-CPOL-0-CPHA-0" class="headerlink" title="模式0(CPOL &#x3D; 0; CPHA &#x3D; 0;)"></a>模式0(CPOL &#x3D; 0; CPHA &#x3D; 0;)</h2><p>特性：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPOL = <span class="number">0</span>：空闲时是低电平，第<span class="number">1</span>个跳变沿是上升沿，第<span class="number">2</span>个跳变沿是下降沿</span><br><span class="line">CPHA = <span class="number">0</span>：数据在第<span class="number">1</span>个跳变沿（上升沿）采样</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/chenborong/image/master/img/SPI总线mode0.png" ><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">模式零           写数据</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _CPOL==0&amp;&amp;_CPHA==0          <span class="comment">//MODE   0  0   </span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SPI_Send_Dat</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> dat)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> n;</span><br><span class="line"><span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line">&#123;</span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(dat&amp;<span class="number">0x80</span>)</span><br><span class="line">MOSI_D(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">MOSI_D(<span class="number">0</span>);</span><br><span class="line">dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*********************************************</span></span><br><span class="line"><span class="comment">模式零         读数据</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">SPI_Receiver_Dat</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> n ,dat,<span class="type">bit_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line">&#123;</span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line">dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(MISO_I())</span><br><span class="line">dat|=<span class="number">0x01</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">dat&amp;=<span class="number">0xfe</span>;</span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="模式1-CPOL-0-CPHA-1"><a href="#模式1-CPOL-0-CPHA-1" class="headerlink" title="模式1(CPOL &#x3D; 0; CPHA &#x3D; 1;)"></a>模式1(CPOL &#x3D; 0; CPHA &#x3D; 1;)</h2><p>特性：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPOL = <span class="number">0</span>：空闲时是低电平，第<span class="number">1</span>个跳变沿是上升沿，第<span class="number">2</span>个跳变沿是下降沿</span><br><span class="line">CPHA = <span class="number">1</span>：数据在第<span class="number">2</span>个跳变沿（下降沿）采样</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/chenborong/image/master/img/SPI总线mode1.png" ><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************</span></span><br><span class="line"><span class="comment">模式一        写数据</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _CPOL==0&amp;&amp;_CPHA==1           <span class="comment">//MODE  0  1</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SPI_Send_Dat</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> dat)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> n;</span><br><span class="line"> SCK_D(<span class="number">0</span>);</span><br><span class="line"> <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line"> &#123;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span>(dat&amp;<span class="number">0x80</span>)MOSI_D(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">else</span> MOSI_D(<span class="number">0</span>);</span><br><span class="line">  dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  SCK_D(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********************************************</span></span><br><span class="line"><span class="comment">模式一       读数据</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">SPI_Receiver_Dat</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> n ,dat,<span class="type">bit_t</span>;</span><br><span class="line"> <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line"> &#123;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">   dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(MISO_I())dat|=<span class="number">0x01</span>;</span><br><span class="line">  <span class="keyword">else</span> dat&amp;=<span class="number">0xfe</span>;</span><br><span class="line">  SCK_D(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line">  SCK_D(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="模式2-CPOL-1-CPHA-0"><a href="#模式2-CPOL-1-CPHA-0" class="headerlink" title="模式2(CPOL &#x3D; 1; CPHA &#x3D; 0;)"></a>模式2(CPOL &#x3D; 1; CPHA &#x3D; 0;)</h2><p>特性:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPOL = <span class="number">1</span>：空闲时是高电平，第<span class="number">1</span>个跳变沿是下降沿，第<span class="number">2</span>个跳变沿是上升沿</span><br><span class="line">CPHA = <span class="number">0</span>：数据在第<span class="number">1</span>个跳变沿（下降沿）采样</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/chenborong/image/master/img/SPI总线mode2.png" ><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">模式二           写数据</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _CPOL==1&amp;&amp;_CPHA==0           <span class="comment">//MODE   1  0</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SPI_Send_Dat</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> dat)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> n;</span><br><span class="line"> <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line"> &#123;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span>(dat&amp;<span class="number">0x80</span>)MOSI_D(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">else</span> MOSI_D(<span class="number">0</span>);</span><br><span class="line">  dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  SCK_D(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********************************************</span></span><br><span class="line"><span class="comment">模式二          读数据</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">SPI_Receiver_Dat</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> n ,dat,<span class="type">bit_t</span>;</span><br><span class="line"> <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line"> &#123;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">  dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(MISO_I())dat|=<span class="number">0x01</span>;</span><br><span class="line">  <span class="keyword">else</span> dat&amp;=<span class="number">0xfe</span>;</span><br><span class="line">  SCK_D(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line">  SCK_D(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="模式3-CPOL-1-CPHA-1"><a href="#模式3-CPOL-1-CPHA-1" class="headerlink" title="模式3(CPOL &#x3D; 1; CPHA &#x3D; 1;)"></a>模式3(CPOL &#x3D; 1; CPHA &#x3D; 1;)</h2><p>特性：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPOL = <span class="number">1</span>：空闲时是高电平，第<span class="number">1</span>个跳变沿是下降沿，第<span class="number">2</span>个跳变沿是上升沿</span><br><span class="line">CPHA = <span class="number">1</span>：数据在第<span class="number">2</span>个跳变沿（上升沿）采样</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/chenborong/image/master/img/SPI总线mode3.png" ><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************</span></span><br><span class="line"><span class="comment">模式三        写数据</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _CPOL==1&amp;&amp;_CPHA==1            <span class="comment">//MODE  1  1</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SPI_Send_Dat</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> dat)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> n;</span><br><span class="line"></span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line">&#123;</span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(dat&amp;<span class="number">0x80</span>)</span><br><span class="line">MOSI_D(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">MOSI_D(<span class="number">0</span>);</span><br><span class="line">dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************</span></span><br><span class="line"><span class="comment">模式三          读数据</span></span><br><span class="line"><span class="comment">************************************/</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">SPI_Receiver_Dat</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> n ,dat,<span class="type">bit_t</span>;</span><br><span class="line"> SCK_D(<span class="number">0</span>);</span><br><span class="line"> <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">8</span>;n++)</span><br><span class="line"> &#123; </span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line">dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(MISO_I())</span><br><span class="line">dat|=<span class="number">0x01</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">  dat&amp;=<span class="number">0xfe</span>;</span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子:"></a>举个栗子:</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iom8535v.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CPOL     1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CPHA     0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCK_IO    DDRA|=0X01</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MOSI_IO   DDRA|=0X02</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MISO_IO   DDRA&amp;=0XFB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SSEL_IO   DDRA|=0X08</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCK_D(X)   (X?(PORTA|=0X01):(PORTA&amp;=0XFE))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MOSI_D(X)  (X?(PORTA|=0X02):(PORTA&amp;=0XFD))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SSEL_D(X)  (X?(PORTA|=0X08):(PORTA&amp;=0XF7))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MISO_I()  (PINA&amp;0X04)  </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="type">char</span> m,n;</span><br><span class="line">     <span class="keyword">for</span>(n=<span class="number">0</span>;n&lt;<span class="number">5</span>;n++);</span><br><span class="line">    <span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;<span class="number">100</span>;m++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************</span></span><br><span class="line"><span class="comment">        端口方向配置  与输出初始化</span></span><br><span class="line"><span class="comment">************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SPI_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">SCK_IO; </span><br><span class="line">MOSI_IO;</span><br><span class="line">MISO_IO; </span><br><span class="line">SSEL_IO;</span><br><span class="line">SSEL_D(<span class="number">1</span>);</span><br><span class="line">MOSI_D(<span class="number">1</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _CPOL==0</span></span><br><span class="line">SCK_D(<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">SCK_D(<span class="number">1</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************</span></span><br><span class="line"><span class="comment">*************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">SPI_Init();</span><br><span class="line">DDRB = <span class="number">0XFF</span>;</span><br><span class="line"><span class="comment">//#if _CPOL</span></span><br><span class="line"><span class="comment">//SCK_D(0);</span></span><br><span class="line"><span class="comment">//#endif</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//SSEL_D(0);</span></span><br><span class="line"><span class="comment">//SPI_Send_Dat(0x01);</span></span><br><span class="line"><span class="comment">//SPI_Send_Dat(0x31);</span></span><br><span class="line"><span class="comment">//SSEL_D(1);</span></span><br><span class="line">SSEL_D(<span class="number">0</span>);</span><br><span class="line">SPI_Send_Dat(<span class="number">0x81</span>);</span><br><span class="line">PORTB =SPI_Receiver_Dat();</span><br><span class="line">SSEL_D(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//delay();</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可控硅驱动</title>
      <link href="/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E5%8F%AF%E6%8E%A7%E7%A1%85%E9%A9%B1%E5%8A%A8/"/>
      <url>/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E5%8F%AF%E6%8E%A7%E7%A1%85%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="可控硅驱动"><a href="#可控硅驱动" class="headerlink" title="可控硅驱动"></a>可控硅驱动</h1><h2 id="斩波"><a href="#斩波" class="headerlink" title="斩波"></a>斩波</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> BIT flag_scr;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_soft_zero            flag_scr.bits.Bit0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_pzero_low            flag_scr.bits.Bit1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//继电器可控硅导通相关</span></span><br><span class="line"><span class="keyword">volatile</span> uchar </span><br><span class="line">tiaojs,</span><br><span class="line">tiao_on,</span><br><span class="line">tiaojs_m,</span><br><span class="line">tiao_on_m,</span><br><span class="line">zero_time;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> zero_time        80</span></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:scr_ctrl() 斩波,无须提前导通</span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     控制继电器可控硅的输出</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">scr_ctrl</span><span class="params">()</span>    </span><br><span class="line">&#123;    </span><br><span class="line">    <span class="keyword">if</span>(!b_chk_AC_PWR_ok)    <span class="keyword">return</span>;        <span class="comment">//等待检测频率完毕</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!p_zero_in)        <span class="comment">//低电平    </span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b_pzero_low)</span><br><span class="line">        &#123;</span><br><span class="line">            b_pzero_low=<span class="number">0</span>;</span><br><span class="line">            b_soft_zero = <span class="number">1</span>;    <span class="comment">//</span></span><br><span class="line">            tiaojs=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//关机,故障,无锅,无水</span></span><br><span class="line">            <span class="keyword">if</span>(!b_onoff || b_error || b_nopot || !b_low_water)  </span><br><span class="line">            &#123;HEAT_OFF();&#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(b_heat_en)    HEAT_ON();        <span class="comment">//继电器过零导通与关闭</span></span><br><span class="line">                <span class="keyword">else</span> HEAT_OFF();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//高电平</span></span><br><span class="line">    <span class="keyword">else</span>    b_pzero_low=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//可控硅部分</span></span><br><span class="line">    <span class="keyword">if</span>(b_scr_en &amp;&amp; !b_nopot &amp;&amp; b_low_water)        <span class="comment">//允许加热</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b_soft_zero)        <span class="comment">//低电平进来</span></span><br><span class="line">        &#123;</span><br><span class="line">            tiaojs++;</span><br><span class="line">            <span class="keyword">if</span>((tiaojs&gt;=tiao_on) &amp;&amp; (tiaojs&lt;(tiao_on+<span class="number">8</span>)))                <span class="comment">//</span></span><br><span class="line">            &#123;</span><br><span class="line">                SCR_ON();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>((tiaojs&gt;=(tiao_on+zero_time)) &amp;&amp; (tiaojs&lt;(tiao_on+zero_time+<span class="number">8</span>)))    <span class="comment">//</span></span><br><span class="line">            &#123;</span><br><span class="line">                SCR_ON();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tiaojs &gt;= (tiao_on+zero_time+<span class="number">8</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                SCR_OFF();</span><br><span class="line">                b_soft_zero=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> SCR_OFF();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> SCR_OFF();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//控制功率</span></span><br><span class="line"><span class="comment">//通过修改tiao_on的值，来改变功率;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_1000</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    tiao_on = p_1000w;    <span class="comment">//全功率</span></span><br><span class="line">    b_scr_en = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_100</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    tiao_on = p_100w;    <span class="comment">//全功率</span></span><br><span class="line">    b_scr_en = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_off</span><span class="params">()</span>        <span class="comment">//关闭可控硅</span></span><br><span class="line">&#123;</span><br><span class="line">    b_scr_en = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="丢波"><a href="#丢波" class="headerlink" title="丢波"></a>丢波</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*====================================================================</span></span><br><span class="line"><span class="comment">方式2:丢波，提前导通</span></span><br><span class="line"><span class="comment">====================================================================*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>        zero_time            76        <span class="comment">//50hz对应半个周期的时间80    80-76 = 4 * 125 = 500us 提前了500us</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Cycle_scr            20        <span class="comment">//20个20ms为一个周期</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Power_full        Cycle_scr    <span class="comment">//全功率;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Power_1000W        10                <span class="comment">//1000W;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Power_500W        5                    <span class="comment">//500W;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Power_100W        1                    <span class="comment">//100W;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:SCR_ON(void) </span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     10个20ms为一个周期, 改变Tiao_power的值，从而改变功率</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">SCR_ON</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="keyword">if</span>(Scr_oncycle &gt;= <span class="number">10</span>)    Scr_oncycle = <span class="number">0</span>;                     </span><br><span class="line">    <span class="keyword">if</span>(Scr_oncycle &lt;= Tiao_power)</span><br><span class="line">        &#123;SCR = <span class="number">1</span>;&#125;                </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;SCR = <span class="number">0</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:SCR_ON2(void) </span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     在一个周期的结束,判断下一个周期是否需要开通？</span></span><br><span class="line"><span class="comment">                若需要,则提前几us开通,</span></span><br><span class="line"><span class="comment">                若不需要,则不开通</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SCR_ON2</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>((Scr_oncycle+<span class="number">1</span>)&lt;=Tiao_power)        <span class="comment">//如果下个周期需要补偿,那么允许提前导通</span></span><br><span class="line">        &#123;SCR = <span class="number">1</span>;&#125;    </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;SCR = <span class="number">0</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:SCR_OFF(void) </span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     可控硅关闭状态</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SCR_OFF</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SCR = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:scr_ctrl(void) 丢波,需要提前导通</span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     控制继电器可控硅的输出</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">Scr_ctrl</span><span class="params">(<span class="type">void</span>)</span> </span><br><span class="line">&#123; </span><br><span class="line">         <span class="keyword">if</span>(!p_zero_in)  <span class="comment">//过零脚 == 0;</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(b_pzero_low)</span><br><span class="line">             &#123;</span><br><span class="line">               b_pzero_low=<span class="number">0</span>;</span><br><span class="line">               bSoft_zero = <span class="number">1</span>; <span class="comment">//</span></span><br><span class="line">               tiaojs=<span class="number">0</span>;</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">else</span> b_pzero_low=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//可控硅部分</span></span><br><span class="line">         <span class="keyword">if</span>(bScr_en)  <span class="comment">//允许加热</span></span><br><span class="line">         &#123;</span><br><span class="line">          <span class="keyword">if</span>(bSoft_zero)  <span class="comment">//软件低电平进来</span></span><br><span class="line">             &#123;</span><br><span class="line">                 tiaojs++;</span><br><span class="line">               <span class="keyword">if</span>((tiaojs&gt;=<span class="number">0</span>) &amp;&amp; (tiaojs&lt;<span class="number">8</span>))                                                <span class="comment">//1</span></span><br><span class="line">                 &#123;  SCR_ON(); &#125;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span>((tiaojs&gt;=zero_time) &amp;&amp; (tiaojs&lt;(zero_time+<span class="number">8</span>)))     <span class="comment">//3</span></span><br><span class="line">              &#123; SCR_ON();&#125;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span>(tiaojs &gt;= (zero_time+<span class="number">80</span>))                                        <span class="comment">//5</span></span><br><span class="line">                 &#123; </span><br><span class="line">                     SCR_ON2();</span><br><span class="line">                     bSoft_zero=<span class="number">0</span>;</span><br><span class="line">                   Scr_oncycle++;</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span> <span class="keyword">if</span>(tiaojs &gt;= (zero_time+<span class="number">8</span>))                                            <span class="comment">//4</span></span><br><span class="line">               &#123;SCR_OFF();&#125;    </span><br><span class="line">               <span class="keyword">else</span> &#123;SCR_OFF();&#125;                                                                     <span class="comment">//2</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123;SCR_OFF();&#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//控制功率</span></span><br><span class="line"><span class="comment">//Tiao_power，来改变功率;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_1000</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Tiao_power = p_1000w;    <span class="comment">//全功率</span></span><br><span class="line">    b_scr_en = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_100</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Tiao_power = p_100w;    <span class="comment">//全功率</span></span><br><span class="line">    b_scr_en = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Power_off</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    b_scr_en = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IO口应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>频率检测</title>
      <link href="/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E9%A2%91%E7%8E%87%E6%A3%80%E6%B5%8B/"/>
      <url>/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E9%A2%91%E7%8E%87%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="频率检测"><a href="#频率检测" class="headerlink" title="频率检测"></a>频率检测</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> BIT flag_scr;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_pzero_low            flag_scr.bits.Bit1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_chk_AC_PWR_ok        flag_scr.bits.Bit2 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_AC_PWR_60HZ        flag_scr.bits.Bit3 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_AC_PWR_start        flag_scr.bits.Bit4 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_AC_PWR_err        flag_scr.bits.Bit5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//频率检测相关</span></span><br><span class="line"><span class="keyword">volatile</span> uchar </span><br><span class="line">AC_pwr_freq,</span><br><span class="line">chk_AC_50HZ_cnt,</span><br><span class="line">chk_AC_60HZ_cnt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************</span></span><br><span class="line"><span class="comment">Funtion:chk_AC_freq() </span></span><br><span class="line"><span class="comment">Input:    None</span></span><br><span class="line"><span class="comment">Output: None</span></span><br><span class="line"><span class="comment">Position:125us</span></span><br><span class="line"><span class="comment">备注:     频率检测</span></span><br><span class="line"><span class="comment">***********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">chk_AC_freq</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(b_chk_AC_PWR_ok)    <span class="keyword">return</span>;            <span class="comment">//检测完毕</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!p_zero_in)                                    <span class="comment">//低电平</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b_pzero_low)                                <span class="comment">//上次是否是高电平</span></span><br><span class="line">        &#123;</span><br><span class="line">            b_pzero_low=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(b_AC_PWR_start)    </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(AC_pwr_freq &gt; <span class="number">192</span>)            <span class="comment">//50hz周期在160  60hz周期在133</span></span><br><span class="line">                &#123;</span><br><span class="line">                    b_AC_PWR_err=<span class="number">1</span>;        </span><br><span class="line">                    b_AC_PWR_start=<span class="number">0</span>;        </span><br><span class="line"><span class="comment">//                    b_chk_AC_PWR_ok=1;</span></span><br><span class="line">                    b_AC_PWR_60HZ=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(AC_pwr_freq &gt; <span class="number">144</span>)    <span class="comment">//50hz</span></span><br><span class="line">                &#123;</span><br><span class="line">                    chk_AC_50HZ_cnt++;</span><br><span class="line">                    <span class="keyword">if</span>(chk_AC_50HZ_cnt &gt;= <span class="number">10</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        chk_AC_50HZ_cnt=<span class="number">0</span>;</span><br><span class="line">                        b_chk_AC_PWR_ok=<span class="number">1</span>;</span><br><span class="line">                        b_AC_PWR_60HZ=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(AC_pwr_freq &gt; <span class="number">112</span>)    <span class="comment">//60hz</span></span><br><span class="line">                &#123;</span><br><span class="line">                    chk_AC_60HZ_cnt++;</span><br><span class="line">                    <span class="keyword">if</span>(chk_AC_60HZ_cnt &gt;= <span class="number">10</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        chk_AC_60HZ_cnt=<span class="number">0</span>;</span><br><span class="line">                        b_chk_AC_PWR_ok=<span class="number">1</span>;</span><br><span class="line">                        b_AC_PWR_60HZ=<span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    b_AC_PWR_err=<span class="number">1</span>;     <span class="comment">//检测频率故障</span></span><br><span class="line"><span class="comment">//                    b_chk_AC_PWR_ok=1;</span></span><br><span class="line">                    b_AC_PWR_60HZ=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                AC_pwr_freq=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                b_AC_PWR_start=<span class="number">1</span>;    <span class="comment">//低电平:检测频率初始化</span></span><br><span class="line">                AC_pwr_freq=<span class="number">0</span>;        </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//高电平</span></span><br><span class="line">    <span class="keyword">else</span> &#123;b_pzero_low=<span class="number">1</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_AC_PWR_start)&#123;AC_pwr_freq++;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IO口应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>海晖电磁炉通讯(汇编)</title>
      <link href="/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%B5%B7%E6%99%96%E7%94%B5%E7%A3%81%E7%82%89%E9%80%9A%E8%AE%AF(%E6%B1%87%E7%BC%96)/"/>
      <url>/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%B5%B7%E6%99%96%E7%94%B5%E7%A3%81%E7%82%89%E9%80%9A%E8%AE%AF(%E6%B1%87%E7%BC%96)/</url>
      
        <content type="html"><![CDATA[<h1 id="海晖电磁炉通讯-汇编"><a href="#海晖电磁炉通讯-汇编" class="headerlink" title="海晖电磁炉通讯(汇编)"></a>海晖电磁炉通讯(汇编)</h1><p>发送代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">;;海晖通讯方式</span><br><span class="line"></span><br><span class="line">;;通讯引脚</span><br><span class="line">pc_outdataequpac0</span><br><span class="line">p_outdataequpa0</span><br><span class="line">pc_uart_inequpac2</span><br><span class="line">p_uart_inequpa2</span><br><span class="line"></span><br><span class="line">;;====================通讯寄存器====================================</span><br><span class="line">senddelaydb?</span><br><span class="line">sendjs    db    ? </span><br><span class="line">send0js   db    ?</span><br><span class="line">send1js   db    ?</span><br><span class="line"></span><br><span class="line">High_cntdb?</span><br><span class="line">Low_Cntdb?</span><br><span class="line">High_Cnt_bkdb?</span><br><span class="line">Low_Cnt_bkdb?</span><br><span class="line">RecCntdb?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;发送数组</span><br><span class="line">Run_ramdb6 dup(?);;</span><br><span class="line">run_ram0equRun_ram[0]</span><br><span class="line">run_ram1equRun_ram[1]</span><br><span class="line">run_ram2equRun_ram[2]</span><br><span class="line">run_ram3equRun_ram[3]</span><br><span class="line">run_ram4equRun_ram[4]</span><br><span class="line">run_ram5equRun_ram[5]</span><br><span class="line">run_ram_sumdb?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;代码</span><br><span class="line">_SINGLE_COMUNICA_PORTAL:</span><br><span class="line"></span><br><span class="line">szsenddelay</span><br><span class="line">jmp send_dec</span><br><span class="line">jmp send_tar</span><br><span class="line">send_dec:</span><br><span class="line">mov a,senddelay</span><br><span class="line">nop</span><br><span class="line">nop</span><br><span class="line">sub a,80</span><br><span class="line">snzc</span><br><span class="line">jmp send_dec2</span><br><span class="line">decsenddelay</span><br><span class="line">clr p_outdata</span><br><span class="line">jmp res_ret </span><br><span class="line"></span><br><span class="line">send_dec2:</span><br><span class="line">dec senddelay</span><br><span class="line">set p_outdata </span><br><span class="line">jmp res_ret </span><br><span class="line"></span><br><span class="line">send_tar:</span><br><span class="line">szsend1js;;发送数据中</span><br><span class="line">jmp sendreset</span><br><span class="line">szsend0js;;发送数据中</span><br><span class="line">jmp sendreset</span><br><span class="line"></span><br><span class="line">szsendjs;;</span><br><span class="line">jmp send_start </span><br><span class="line"></span><br><span class="line">mov a,56</span><br><span class="line">mov sendjs,a;;数据</span><br><span class="line"></span><br><span class="line">mov a,85</span><br><span class="line">nop</span><br><span class="line">mov senddelay,a;;中途的延时 </span><br><span class="line"></span><br><span class="line">mova,PowerRef;;目标电流值</span><br><span class="line">mov run_ram0,a</span><br><span class="line"></span><br><span class="line">mova,CTRL_FLAG;;标志位</span><br><span class="line">mov run_ram1,a</span><br><span class="line"></span><br><span class="line">mova,CTRL_FLAG1;;标志位</span><br><span class="line">mov run_ram2,a</span><br><span class="line"></span><br><span class="line">mov a,heathuoli;;0-15火力</span><br><span class="line">mov run_ram3,a</span><br><span class="line"></span><br><span class="line">mov a,DEBUG_STAGE;;0~30h</span><br><span class="line">mov run_ram4,a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mov a,run_ram0</span><br><span class="line">adda,run_ram1</span><br><span class="line">adda,run_ram2</span><br><span class="line">adda,run_ram3</span><br><span class="line">adda,run_ram4</span><br><span class="line">adda,run_ram5</span><br><span class="line">mov run_ram_sum,a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set _WRITE_OKF;;表示在中途的延时中</span><br><span class="line">clr send0js</span><br><span class="line">clr send1js</span><br><span class="line">jmp send_low1</span><br><span class="line"></span><br><span class="line">send_start:</span><br><span class="line">nop</span><br><span class="line">nop</span><br><span class="line">dec sendjs</span><br><span class="line">clr c</span><br><span class="line">rlc run_ram_sum;;校验和</span><br><span class="line">rlcrun_ram0</span><br><span class="line">rlc run_ram1</span><br><span class="line">rlc run_ram2</span><br><span class="line">rlc run_ram3</span><br><span class="line">rlc run_ram4</span><br><span class="line">rlc run_ram5</span><br><span class="line"></span><br><span class="line">szc</span><br><span class="line">jmp send_high</span><br><span class="line"></span><br><span class="line">send_low:</span><br><span class="line">mov a,4</span><br><span class="line">mov send1js,a</span><br><span class="line">mov a,8</span><br><span class="line">mov send0js,a</span><br><span class="line">jmp sendreset</span><br><span class="line"></span><br><span class="line">send_high:</span><br><span class="line">mov a,8</span><br><span class="line">mov send1js,a</span><br><span class="line">mov a,4</span><br><span class="line">mov send0js,a</span><br><span class="line">sendreset:</span><br><span class="line">szsend1js</span><br><span class="line">jmp send_l2</span><br><span class="line">jmp send_l1</span><br><span class="line">send_l2:</span><br><span class="line">dec send1js</span><br><span class="line">send_low1:</span><br><span class="line">clr p_outdata</span><br><span class="line">jmp res_ret </span><br><span class="line">send_l1:</span><br><span class="line">dec send0js</span><br><span class="line">set p_outdata</span><br></pre></td></tr></table></figure><p>接收部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">;;接收数组</span><br><span class="line">Recdb8 dup(?);;</span><br><span class="line">Rec_ram0equRec[0]</span><br><span class="line">Rec_ram1equRec[1]</span><br><span class="line">Rec_ram2equRec[2]</span><br><span class="line">Rec_ram3equRec[3]</span><br><span class="line"></span><br><span class="line">Send_testdb?</span><br><span class="line">Rec_testdb?</span><br><span class="line"></span><br><span class="line">key_flag1db?</span><br><span class="line">_WRITE_OKFequkey_flag1.0</span><br><span class="line">b_rec_start equkey_flag1.2</span><br><span class="line">b_rec_endequkey_flag1.3</span><br><span class="line">b_Rec_Hequkey_flag1.4</span><br><span class="line">b_rec_okequkey_flag1.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;接收部分==========================================</span><br><span class="line">;;==================================================</span><br><span class="line">res_ret:</span><br><span class="line">set pc_uart_in</span><br><span class="line"></span><br><span class="line">snzp_uart_in</span><br><span class="line">jmp Rec_L</span><br><span class="line">snzp_uart_in</span><br><span class="line">jmp Rec_L</span><br><span class="line"></span><br><span class="line">;;高电平</span><br><span class="line">Rec_H:</span><br><span class="line">szLow_Cnt</span><br><span class="line">jmp $+2</span><br><span class="line">jmp $+4</span><br><span class="line"></span><br><span class="line">mov a,Low_Cnt</span><br><span class="line">mov Low_Cnt_bk,a;;刷新低电平计数</span><br><span class="line">clr Low_Cnt</span><br><span class="line"></span><br><span class="line">setb_Rec_H</span><br><span class="line"></span><br><span class="line">incHigh_cnt</span><br><span class="line">mov a,high_cnt</span><br><span class="line">sub a,60;;10ms = 80 * 125us</span><br><span class="line">snzc</span><br><span class="line">jmp rec_out</span><br><span class="line"></span><br><span class="line">clr RecCnt</span><br><span class="line">set b_rec_start;;接收高电平超过7ms</span><br><span class="line"></span><br><span class="line">jmp rec_out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;低电平</span><br><span class="line">Rec_L:</span><br><span class="line">inc Low_Cnt</span><br><span class="line"></span><br><span class="line">szb_rec_start;;第一个低电平，第一段长的高电平</span><br><span class="line">jmp rec_low_end</span><br><span class="line"></span><br><span class="line">szHigh_cnt</span><br><span class="line">jmp $+2</span><br><span class="line">jmp $+4</span><br><span class="line"></span><br><span class="line">mov a,High_cnt</span><br><span class="line">mov High_Cnt_bk,a;;刷新高电平计数</span><br><span class="line">clr High_cnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">snzb_Rec_H;;上一个125us是高电平</span><br><span class="line">jmp rec_low_end</span><br><span class="line"></span><br><span class="line">mov a,Low_Cnt_bk</span><br><span class="line">sub a,0</span><br><span class="line">szz</span><br><span class="line">jmp rec_low_end</span><br><span class="line"></span><br><span class="line">rec_s2:</span><br><span class="line">mov a,Low_Cnt_bk</span><br><span class="line">sub a,High_Cnt_bk</span><br><span class="line">rlc Rec[0];;校验和</span><br><span class="line">rlcRec[1]</span><br><span class="line">rlc Rec[2]</span><br><span class="line"></span><br><span class="line">inc RecCnt</span><br><span class="line">mov a,RecCnt</span><br><span class="line">sub a,24</span><br><span class="line">snzc</span><br><span class="line">jmp rec_low_end</span><br><span class="line">clr RecCnt</span><br><span class="line"></span><br><span class="line">mova,Rec[1]</span><br><span class="line">adda,Rec[2]</span><br><span class="line">sub a,Rec[0];;校验和</span><br><span class="line">szz</span><br><span class="line">set _READ_OKF;;校验通过</span><br><span class="line"></span><br><span class="line">;snz_READ_OKF</span><br><span class="line">;jmp rec_low_end</span><br><span class="line">;</span><br><span class="line">;mov a,Rec[1]</span><br><span class="line">;mov Rec_test,a</span><br><span class="line"></span><br><span class="line">rec_low_end:</span><br><span class="line">clr b_rec_start</span><br><span class="line">clr High_cnt</span><br><span class="line">clr b_Rec_H</span><br><span class="line">clr Low_Cnt_bk</span><br><span class="line"></span><br><span class="line">rec_out:</span><br></pre></td></tr></table></figure><p>数据处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">;;***********************************************************</span><br><span class="line">;;*NAME:communicate                         *</span><br><span class="line">;;*INPUT    :                                               *</span><br><span class="line">;;*OUTPUT   :                                               *</span><br><span class="line">;;*USED REG.:                                               *</span><br><span class="line">;;*FUNCTION :通讯函数                                               *</span><br><span class="line">;;***********************************************************</span><br><span class="line">communicate:</span><br><span class="line">;;发送</span><br><span class="line">snz_WRITE_OKF</span><br><span class="line">jmp send_delay </span><br><span class="line">send_delay:</span><br><span class="line">clr _WRITE_OKF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;接收</span><br><span class="line">Rec_com:</span><br><span class="line">snz_READ_OKF</span><br><span class="line">jmp  rec_delay</span><br><span class="line"></span><br><span class="line">rec_delay:</span><br><span class="line">clr _READ_OKF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电磁炉 </tag>
            
            <tag> 海晖通讯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>海晖电磁炉通讯(C)</title>
      <link href="/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%B5%B7%E6%99%96%E7%94%B5%E7%A3%81%E7%82%89%E9%80%9A%E8%AE%AF(C)/"/>
      <url>/2023/03/03/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%B5%B7%E6%99%96%E7%94%B5%E7%A3%81%E7%82%89%E9%80%9A%E8%AE%AF(C)/</url>
      
        <content type="html"><![CDATA[<h1 id="海晖电磁炉通讯-C"><a href="#海晖电磁炉通讯-C" class="headerlink" title="海晖电磁炉通讯(C)"></a>海晖电磁炉通讯(C)</h1><p>发送部分</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _HIGHMAX    70  <span class="comment">//10ms = 80 * 125us</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _RECNUMBER  3   <span class="comment">//接收的组数</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SENDNUMBER 3   <span class="comment">//发送的组数</span></span></span><br><span class="line"></span><br><span class="line">EXTERN BIT com_flag;    <span class="comment">//通讯标志位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_Rec_H       com_flag.bits.Bit0  <span class="comment">//接收高电平标志</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_rec_start   com_flag.bits.Bit1  <span class="comment">//接收开始标志  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_Rec_Ok      com_flag.bits.Bit2  <span class="comment">//接收校验通过标志</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> b_Secok       com_flag.bits.Bit3  <span class="comment">//  </span></span></span><br><span class="line"><span class="comment">//接收</span></span><br><span class="line">EXTERN uchar High_Cnt,High_Cnt_bk,Low_Cnt,Low_Cnt_bk;</span><br><span class="line">EXTERN uchar RecData_bk,RecCnt,RecChk;</span><br><span class="line"><span class="comment">//发送</span></span><br><span class="line">EXTERN uchar Send0js,Send1js,Send_Delay,Sendjs;</span><br><span class="line">EXTERN uchar Send_cnt;</span><br><span class="line"></span><br><span class="line">EXTERN uchar Rec[_RECNUMBER];</span><br><span class="line">EXTERN uchar RecData[_RECNUMBER];</span><br><span class="line">EXTERN uchar SendData[_SENDNUMBER];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Send_Part()</span></span><br><span class="line"><span class="comment">输入:无</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:发送部分,125us进来一次</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Send_Part</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar Send_Sum = <span class="number">0</span>,i;</span><br><span class="line">    <span class="type">static</span> uchar Dat_Temp;</span><br><span class="line">    <span class="keyword">if</span>(Send_Delay)</span><br><span class="line">    &#123;</span><br><span class="line">        Send_Delay--;</span><br><span class="line">        <span class="keyword">if</span>(Send_Delay &lt; <span class="number">80</span>) &#123;Send_H();&#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;Send_L();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">//发送数据中</span></span><br><span class="line">        <span class="keyword">if</span>(Send1js)    &#123;Send1js--;Send_L();&#125;        <span class="comment">//优先发送低电平</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Send0js)   &#123;Send0js--;Send_H();&#125;    <span class="comment">//发送高电平</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Sendjs)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!(Sendjs%<span class="number">8</span>)) &#123;Dat_Temp = SendData[_SENDNUMBER - Sendjs/<span class="number">8</span>];&#125;</span><br><span class="line">            <span class="keyword">if</span>(Dat_Temp &amp; <span class="number">0x80</span>) &#123;High_Grop();&#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;Low_Grop();&#125;</span><br><span class="line">            Dat_Temp &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            Sendjs--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//开始分配</span></span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            Sendjs = <span class="number">8</span> * _SENDNUMBER;</span><br><span class="line">            Send_Delay = <span class="number">85</span>;</span><br><span class="line"></span><br><span class="line">            SendData[<span class="number">0</span>] = <span class="number">0x67</span>;</span><br><span class="line">            SendData[<span class="number">1</span>] = Send_cnt;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; (_SENDNUMBER<span class="number">-1</span>);i++) Send_Sum += SendData[i];</span><br><span class="line">            SendData[<span class="number">2</span>] = Send_Sum; <span class="comment">//发送校验和</span></span><br><span class="line"></span><br><span class="line">            b_Secok = <span class="number">1</span>;    <span class="comment">//</span></span><br><span class="line">            Send0js = Send1js = <span class="number">0</span>;</span><br><span class="line">            Send_L();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接收部分</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Rec_Part()</span></span><br><span class="line"><span class="comment">输入:无</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:通讯接收,125us进来一次</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Rec_Part</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    <span class="comment">//高电平</span></span><br><span class="line">    <span class="keyword">if</span>(p_rec)</span><br><span class="line">    &#123;</span><br><span class="line">        b_Rec_H = <span class="number">1</span>;        <span class="comment">//高电平标志</span></span><br><span class="line">        <span class="comment">//开始</span></span><br><span class="line">        High_Cnt++;</span><br><span class="line">        <span class="keyword">if</span>(High_Cnt &gt;= _HIGHMAX)</span><br><span class="line">        &#123;</span><br><span class="line">            RecCnt = <span class="number">0</span>;</span><br><span class="line">            b_rec_start = <span class="number">1</span>;        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过去低电平计数</span></span><br><span class="line">        <span class="keyword">if</span>(Low_Cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            Low_Cnt_bk = Low_Cnt;   </span><br><span class="line">            Low_Cnt = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//低电平</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        Low_Cnt++;</span><br><span class="line">        <span class="comment">//过去的高电平</span></span><br><span class="line">        <span class="keyword">if</span>((High_Cnt &gt; <span class="number">0</span>)&amp;&amp;(High_Cnt &lt; _HIGHMAX))   </span><br><span class="line">        &#123;</span><br><span class="line">            High_Cnt_bk = High_Cnt;</span><br><span class="line">            High_Cnt = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!b_rec_start &amp;&amp; b_Rec_H)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Low_Cnt_bk &gt; High_Cnt_bk) RecData_bk |= <span class="number">0x01</span>;</span><br><span class="line">            RecCnt++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!(RecCnt%<span class="number">8</span>)) <span class="comment">//满足8位</span></span><br><span class="line">            &#123;</span><br><span class="line">                Rec[RecCnt/<span class="number">8</span><span class="number">-1</span>] = RecData_bk;</span><br><span class="line">                RecData_bk = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">8</span> * _RECNUMBER &lt;= RecCnt)</span><br><span class="line">                &#123;</span><br><span class="line">                    RecChk = RecCnt = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; (_RECNUMBER<span class="number">-1</span>);i++) RecChk += Rec[i]; <span class="comment">//计算校验和</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(RecChk == Rec[_RECNUMBER<span class="number">-1</span>]) </span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; _RECNUMBER;i++) RecData[i] = Rec[i];</span><br><span class="line">                        Send_cnt = RecData[<span class="number">1</span>];                       </span><br><span class="line">                        b_Rec_Ok = <span class="number">1</span>;</span><br><span class="line">                    &#125;<span class="comment">//校验通过</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> RecData_bk &lt;&lt;= <span class="number">1</span>; <span class="comment">//继续移位 </span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        b_Rec_H = <span class="number">0</span>;</span><br><span class="line">        High_Cnt = <span class="number">0</span>;</span><br><span class="line">        b_rec_start = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数据处理</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Uart_Process()</span></span><br><span class="line"><span class="comment">输入:无</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:主函数,数据处理</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Uart_Process</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_Secok)</span><br><span class="line">    &#123;</span><br><span class="line">        b_Secok = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//校验通过</span></span><br><span class="line">    <span class="keyword">if</span>(b_Rec_Ok)</span><br><span class="line">    &#123;</span><br><span class="line">        b_Rec_Ok = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电磁炉 </tag>
            
            <tag> 海晖通讯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_Task的任务挂起,恢复,任务调度</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8C%82%E8%B5%B7/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8C%82%E8%B5%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的任务挂起-恢复-任务调度"><a href="#FreeRTOS-Task的任务挂起-恢复-任务调度" class="headerlink" title="FreeRTOS_Task的任务挂起,恢复,任务调度"></a>FreeRTOS_Task的任务挂起,恢复,任务调度</h1><h2 id="在main函数挂起任务"><a href="#在main函数挂起任务" class="headerlink" title="在main函数挂起任务"></a>在main函数挂起任务</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask2</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task2-222\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t pxTask1;</span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask1);</span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">3000</span> / portTICK_PERIOD_MS);<span class="comment">//延时3sec后</span></span><br><span class="line">    vTaskSuspend(pxTask1);<span class="comment">//挂起任务1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在任务内部挂起"><a href="#在任务内部挂起" class="headerlink" title="在任务内部挂起"></a>在任务内部挂起</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line"></span><br><span class="line">        vTaskSuspend(<span class="literal">NULL</span>);<span class="comment">//任务挂起</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask2</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task2-222\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t pxTask1;</span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask1);</span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="挂起的任务恢复"><a href="#挂起的任务恢复" class="headerlink" title="挂起的任务恢复"></a>挂起的任务恢复</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask2</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task2-222\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t pxTask1;</span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask1);</span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    vTaskSuspend(pxTask1);<span class="comment">//挂起任务</span></span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">5000</span> / portTICK_PERIOD_MS);<span class="comment">//延时5sec</span></span><br><span class="line">    vTaskResume(pxTask1);<span class="comment">//恢复任务</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="任务调度"><a href="#任务调度" class="headerlink" title="任务调度"></a>任务调度</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Test begin\n&quot;</span>);</span><br><span class="line">    vTaskSuspendAll();<span class="comment">//全部挂起</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//此处函数不得使用FreeRTOS API的函数,且挂起后均不受其它Task影响</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">999</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">999</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    xTaskResumeAll();<span class="comment">//恢复</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Test end\n&quot;</span>);</span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_Task的优先级</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的优先级"><a href="#FreeRTOS-Task的优先级" class="headerlink" title="FreeRTOS_Task的优先级"></a>FreeRTOS_Task的优先级</h1><h2 id="获取优先级"><a href="#获取优先级" class="headerlink" title="获取优先级"></a>获取优先级</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *pcTxt = <span class="string">&quot;I am Rainjai&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//---------------------------------------</span></span><br><span class="line">    UBaseType_t iPriority = <span class="number">0</span>;<span class="comment">//typedef unsigned int      UBaseType_t;</span></span><br><span class="line">    TaskHandle_t pxTask = <span class="literal">NULL</span>;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, (<span class="type">void</span> *)&amp;pcTxt, <span class="number">1</span>, &amp;pxTask);</span><br><span class="line"></span><br><span class="line">    iPriority = uxTaskPriorityGet(pxTask);  <span class="comment">//取得当前该句柄的优先级</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;iPriority = %d\n&quot;</span>,iPriority);   <span class="comment">//并且打印出来</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask2</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task2-222\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123; </span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);<span class="comment">//这个先创建,先打印这个</span></span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);<span class="comment">//</span></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123; </span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">2</span>, <span class="literal">NULL</span>);<span class="comment">//这个优先级更高,先打印这个</span></span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);<span class="comment">//</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="修改优先级别"><a href="#修改优先级别" class="headerlink" title="修改优先级别"></a>修改优先级别</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask2</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task2-222\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123; </span><br><span class="line">    UBaseType_t iPriority = <span class="number">0</span>;</span><br><span class="line">    TaskHandle_t pxTask = <span class="literal">NULL</span>;<span class="comment">//定义一个句柄</span></span><br><span class="line">    </span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask);<span class="comment">//</span></span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">2</span>, <span class="literal">NULL</span>);<span class="comment">//</span></span><br><span class="line">    </span><br><span class="line">    vTaskPrioritySet(pxTask,<span class="number">3</span>);<span class="comment">//修改句柄pxTask的优先级别为3</span></span><br><span class="line">    iPriority = uxTaskPriorityGet(pxTask);  <span class="comment">//取得该句柄的优先级</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;iPriority = %d\n&quot;</span>,iPriority);   <span class="comment">//并且打印出来</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_Task的堆栈</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E5%A0%86%E6%A0%88/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E5%A0%86%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的堆栈"><a href="#FreeRTOS-Task的堆栈" class="headerlink" title="FreeRTOS_Task的堆栈"></a>FreeRTOS_Task的堆栈</h1><h2 id="uxTaskGetStackHighWaterMark-函数"><a href="#uxTaskGetStackHighWaterMark-函数" class="headerlink" title="uxTaskGetStackHighWaterMark()  函数"></a>uxTaskGetStackHighWaterMark()  函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">myTask1</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;task1-111\n&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t pxTask1;</span><br><span class="line">    UBaseType_t iStack;        <span class="comment">//定义变量表示剩余堆栈</span></span><br><span class="line"></span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask1);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       iStack = uxTaskGetStackHighWaterMark(pxTask1);    <span class="comment">//iStack 剩余堆栈</span></span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;task1 iStack = %d\n&quot;</span>,iStack);            <span class="comment">//打印myTask1的剩余堆栈</span></span><br><span class="line"></span><br><span class="line">       vTaskDelay(<span class="number">3000</span> / portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_创建Task</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%A0%E9%99%A4/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%A0%E9%99%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的创建与删除"><a href="#FreeRTOS-Task的创建与删除" class="headerlink" title="FreeRTOS_Task的创建与删除"></a>FreeRTOS_Task的创建与删除</h1><h2 id="Task的介绍"><a href="#Task的介绍" class="headerlink" title="Task的介绍"></a>Task的介绍</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h”</span></span><br><span class="line">BaseType_t <span class="title function_">xTaskCreate</span><span class="params">( TaskFunction_t pvTaskCode,</span></span><br><span class="line"><span class="params">                        <span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> pcName,</span></span><br><span class="line"><span class="params">                        <span class="type">unsigned</span> <span class="type">short</span> usStackDepth,</span></span><br><span class="line"><span class="params">                        <span class="type">void</span> *pvParameters,</span></span><br><span class="line"><span class="params">                        UBaseType_t uxPriority,</span></span><br><span class="line"><span class="params">                        TaskHandle_t *pxCreatedTask )</span>;</span><br><span class="line"></span><br><span class="line"> pvTaskCode :    一个空指针,例子：<span class="type">void</span> *pvParam</span><br><span class="line"> pcName        :    Task名称</span><br><span class="line"> usStackDepth:    分配内存</span><br><span class="line"> *pvParameters:</span><br><span class="line"> uxPriority    :    优先级</span><br><span class="line"> *pxCreatedTask:</span><br></pre></td></tr></table></figure><h2 id="Task的创建"><a href="#Task的创建" class="headerlink" title="Task的创建"></a>Task的创建</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h”</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span>/portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Task的删除"><a href="#Task的删除" class="headerlink" title="Task的删除"></a>Task的删除</h2><h3 id="方法1-在main函数中删除Task"><a href="#方法1-在main函数中删除Task" class="headerlink" title="方法1 在main函数中删除Task"></a>方法1 在main函数中删除Task</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h”</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        vTaskDelay(<span class="number">1000</span>/portTICK_PERIOD_MS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t myHandle = <span class="literal">NULL</span>;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;myHandle);    <span class="comment">//Task的创建</span></span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">1000</span>/portTICK_PERIOD_MS);</span><br><span class="line">    <span class="keyword">if</span>(myHandle != <span class="literal">NULL</span>)</span><br><span class="line">        vTaskDelete(myHandle);    <span class="comment">//删除Task</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法2-在Task里面删除Task"><a href="#方法2-在Task里面删除Task" class="headerlink" title="方法2 在Task里面删除Task"></a>方法2 在Task里面删除Task</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h”</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    vTaskDelay(<span class="number">1000</span>/portTICK_PERIOD_MS);    <span class="comment">//让单片机有机会跑vTaskDelete函数</span></span><br><span class="line"></span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);    <span class="comment">//删除当前的Task</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);    <span class="comment">//Task的创建</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_Task的系统信息</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的系统信息"><a href="#FreeRTOS-Task的系统信息" class="headerlink" title="FreeRTOS_Task的系统信息"></a>FreeRTOS_Task的系统信息</h1><h2 id="打印系统信息"><a href="#打印系统信息" class="headerlink" title="打印系统信息"></a>打印系统信息</h2><p>先配置好SDK信息</p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/ESP32/FreeRTOS/FreeRTOS_Task的系统信息/图1.jpg" style="zoom: 200%;" /><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TaskHandle_t pxTask1;</span><br><span class="line">    xTaskCreate(myTask1, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, &amp;pxTask1);</span><br><span class="line">    xTaskCreate(myTask2, <span class="string">&quot;myTask2&quot;</span>, <span class="number">1024</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> pcWriteBuffer[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    vTaskList(pcWriteBuffer);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------------------------------------------------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------------------------------------------------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Name        State       Priority        Stack       Num\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;函数名称      状态       优先级          堆栈       Num\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,pcWriteBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FreeRTOS_Task的输入参数</title>
      <link href="/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0/"/>
      <url>/2023/01/28/Hugo%20Blog/FreeRTOS/FreeRTOS_Task%E7%9A%84%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="FreeRTOS-Task的输入参数"><a href="#FreeRTOS-Task的输入参数" class="headerlink" title="FreeRTOS_Task的输入参数"></a>FreeRTOS_Task的输入参数</h1><h2 id="传入一个变量"><a href="#传入一个变量" class="headerlink" title="传入一个变量"></a>传入一个变量</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h” </span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *pInt;</span><br><span class="line">    pInt = (<span class="type">int</span> *pvParam);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got testNum = %d\n&quot;</span>,*pInt);<span class="comment">//将指针的内容打印出来</span></span><br><span class="line">    </span><br><span class="line">    vTaskDelay(<span class="number">1000</span>/portTICK_PERIOD_MS);</span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> testNum = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask,<span class="string">&quot;myTask1&quot;</span>,<span class="number">1024</span>,(<span class="type">void</span> *)&amp;testNum,<span class="number">1</span>,<span class="literal">NULL</span>);<span class="comment">//将变量testNum的地址传入进去</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="传入一个数组"><a href="#传入一个数组" class="headerlink" title="传入一个数组"></a>传入一个数组</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h”</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个数组</span></span><br><span class="line"><span class="type">int</span> testNum[] = &#123;<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *pArrayAddr;<span class="comment">//定义一个中间变量</span></span><br><span class="line">    pArrayAddr = (<span class="type">int</span> *)pvParam;<span class="comment">//统一类型</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got num1 = %d\n&quot;</span>,*pArrayAddr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got num1 = %d\n&quot;</span>,*(pArrayAddr+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got num1 = %d\n&quot;</span>,*(pArrayAddr+<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line"></span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> app_main(<span class="type">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, (<span class="type">void</span> *)testNum, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="传入结构体"><a href="#传入结构体" class="headerlink" title="传入结构体"></a>传入结构体</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h” </span></span><br><span class="line"><span class="comment">//申请一个结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>  <span class="title">A_STRUCT</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> iMenu1;</span><br><span class="line">    <span class="type">int</span> iMenu2;</span><br><span class="line">&#125;xStruct;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个结构体变量</span></span><br><span class="line">xStruct xStrTest = &#123;<span class="number">6</span>,<span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    xStruct *pStrTest;  <span class="comment">//定义一个中间变量</span></span><br><span class="line"></span><br><span class="line">    pStrTest = (xStruct *)pvParam;  <span class="comment">//统一类型</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got struct iMenu1 = %d\n&quot;</span>,pStrTest-&gt;iMenu1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got struct iMenu2 = %d\n&quot;</span>,pStrTest-&gt;iMenu2);</span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line"></span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, (<span class="type">void</span> *)&amp;xStrTest, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="传入一个字符串"><a href="#传入一个字符串" class="headerlink" title="传入一个字符串"></a>传入一个字符串</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> “FreeRTOS.h”</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> “task.h” </span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *pcTxt = <span class="string">&quot;I am Rainjai&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myTask</span><span class="params">(<span class="type">void</span> *pvParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *pcTxtInTask;  <span class="comment">//定义一个中间变量</span></span><br><span class="line"></span><br><span class="line">    pcTxtInTask = (<span class="type">char</span> *)pvParam;  <span class="comment">//统一类型</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I got message = %s\n&quot;</span>,pcTxtInTask);</span><br><span class="line"></span><br><span class="line">    vTaskDelay(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line"></span><br><span class="line">    vTaskDelete(<span class="literal">NULL</span>);</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    xTaskCreate(myTask, <span class="string">&quot;myTask1&quot;</span>, <span class="number">1024</span>, (<span class="type">void</span> *)&amp;pcTxt, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> FreeRTOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FreeRTOS </tag>
            
            <tag> ESP32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CRC校验</title>
      <link href="/2022/12/28/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/CRC%E6%A0%A1%E9%AA%8C/"/>
      <url>/2022/12/28/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/CRC%E6%A0%A1%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="CRC校验"><a href="#CRC校验" class="headerlink" title="CRC校验"></a>CRC校验</h1><p>type.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TYPE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TYPE_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>        u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span>       u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>         u32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>   u64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>        BOOL;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FALSE                0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUE                 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>crc.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CRC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CRC_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;type.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u8    poly;    <span class="comment">//多项式</span></span><br><span class="line">    u8    InitValue;    <span class="comment">//初始值</span></span><br><span class="line">    u8    xor;    <span class="comment">//结果异或值</span></span><br><span class="line">    BOOL    InputReverse;</span><br><span class="line">    BOOL    OutputReverse;</span><br><span class="line">&#125;CRC_8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u16    poly;    <span class="comment">//多项式</span></span><br><span class="line">    u16    InitValue;    <span class="comment">//初始值</span></span><br><span class="line">    u16    xor;    <span class="comment">//结果异或值</span></span><br><span class="line">    BOOL    InputReverse;</span><br><span class="line">    BOOL    OutputReverse;</span><br><span class="line">&#125;CRC_16;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u32    poly;    <span class="comment">//多项式</span></span><br><span class="line">    u32    InitValue;    <span class="comment">//初始值</span></span><br><span class="line">    u32    xor;    <span class="comment">//结果异或值</span></span><br><span class="line">    BOOL    InputReverse;</span><br><span class="line">    BOOL    OutputReverse;</span><br><span class="line">&#125;CRC_32;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span>    CRC_8    crc_8;</span><br><span class="line"><span class="type">const</span>    CRC_8    crc_8_ITU;</span><br><span class="line"><span class="type">const</span>    CRC_8    crc_8_ROHC;</span><br><span class="line"><span class="type">const</span>    CRC_8    crc_8_MAXIM;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_IBM;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_MAXIM;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_USB;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_MODBUS;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_CCITT;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_CCITT_FALSE;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_X5;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_XMODEM;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_DNP;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> CRC_32 crc_32;</span><br><span class="line"><span class="type">const</span> CRC_32 crc_32_MPEG2;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">crc8</span><span class="params">(u8 *addr, <span class="type">int</span> num,CRC_8 type)</span> ;</span><br><span class="line">u16 <span class="title function_">crc16</span><span class="params">(u8 *addr, <span class="type">int</span> num,CRC_16 type)</span> ;</span><br><span class="line">u32 <span class="title function_">crc32</span><span class="params">(u8 *addr, <span class="type">int</span> num,CRC_32 type)</span> ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>    <span class="comment">//__CRC_H__</span></span></span><br></pre></td></tr></table></figure><p>crc.c文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;type.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CRC.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> CRC_8 crc_8 = &#123;<span class="number">0x07</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,FALSE,FALSE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_8 crc_8_ITU = &#123;<span class="number">0x07</span>,<span class="number">0x00</span>,<span class="number">0x55</span>,FALSE,FALSE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_8 crc_8_ROHC = &#123;<span class="number">0x07</span>,<span class="number">0xff</span>,<span class="number">0x00</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_8 crc_8_MAXIM = &#123;<span class="number">0x31</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,TRUE,TRUE&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_IBM = &#123;<span class="number">0x8005</span>,<span class="number">0x0000</span>,<span class="number">0x0000</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_MAXIM = &#123;<span class="number">0x8005</span>,<span class="number">0x0000</span>,<span class="number">0xffff</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_USB = &#123;<span class="number">0x8005</span>,<span class="number">0xffff</span>,<span class="number">0xffff</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_MODBUS = &#123;<span class="number">0x8005</span>,<span class="number">0xffff</span>,<span class="number">0x0000</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_CCITT = &#123;<span class="number">0x1021</span>,<span class="number">0x0000</span>,<span class="number">0x0000</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_CCITT_FALSE = &#123;<span class="number">0x1021</span>,<span class="number">0xffff</span>,<span class="number">0x0000</span>,FALSE,FALSE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_X5 = &#123;<span class="number">0x1021</span>,<span class="number">0xffff</span>,<span class="number">0xffff</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_XMODEM = &#123;<span class="number">0x1021</span>,<span class="number">0x0000</span>,<span class="number">0x0000</span>,FALSE,FALSE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_16 crc_16_DNP = &#123;<span class="number">0x3d65</span>,<span class="number">0x0000</span>,<span class="number">0xffff</span>,TRUE,TRUE&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> CRC_32 crc_32 = &#123;<span class="number">0x04c11db7</span>,<span class="number">0xffffffff</span>,<span class="number">0xffffffff</span>,TRUE,TRUE&#125;;</span><br><span class="line"><span class="type">const</span> CRC_32 crc_32_MPEG2 = &#123;<span class="number">0x04c11db7</span>,<span class="number">0xffffffff</span>,<span class="number">0x00000000</span>,FALSE,FALSE&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">*function name:reverse8</span></span><br><span class="line"><span class="comment">*function: 字节反转,比如1100 0101 反转后 1010 0011</span></span><br><span class="line"><span class="comment">*input: 1字节</span></span><br><span class="line"><span class="comment">*output: 反转后字节</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line">u8 <span class="title function_">reverse8</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i;</span><br><span class="line">    u8 temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        temp |= ((data &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; (<span class="number">7</span>-i);</span><br><span class="line">       <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">*function name:reverse16</span></span><br><span class="line"><span class="comment">*function: 双字节反转，如1100 0101 1110 0101反转后为1010 0111 1010 0011</span></span><br><span class="line"><span class="comment">*input：双字节</span></span><br><span class="line"><span class="comment">*output:反转后双字节</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line">u16 <span class="title function_">reverse16</span> <span class="params">(u16 data)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i;</span><br><span class="line">    u16 temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i  &lt; <span class="number">16</span>; i++)</span><br><span class="line">        temp |= ((data &gt;&gt; i) &amp; <span class="number">0x0001</span>) &lt;&lt; (<span class="number">15</span> - i);</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">*function name:reverse32</span></span><br><span class="line"><span class="comment">*function: 32bit字节反转</span></span><br><span class="line"><span class="comment">*input：32bit字</span></span><br><span class="line"><span class="comment">*output:反转后的32bit字</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line">u32 <span class="title function_">reverse16</span> <span class="params">(u32 data)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i;</span><br><span class="line">    u32 temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i  &lt; <span class="number">32</span>; i++)</span><br><span class="line">        temp |= ((data &gt;&gt; i) &amp; <span class="number">0x0001</span>) &lt;&lt; (<span class="number">31</span> - i);</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">*function name:crc8</span></span><br><span class="line"><span class="comment">*function: CRC校验,校验值为8位</span></span><br><span class="line"><span class="comment">*input：addr-数据首地址;num-数据长度(字节);type-CRC8的算法类型</span></span><br><span class="line"><span class="comment">*output:8位校验值</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line">u8 <span class="title function_">crc8</span><span class="params">(u8 *addr,<span class="type">int</span> num,CRC_8 tpye)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 data;</span><br><span class="line">    u8 crc = type.InitValue;        <span class="comment">//初始值</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(; num &gt; <span class="number">0</span>; num--)</span><br><span class="line">    &#123;</span><br><span class="line">        data = *addr++;</span><br><span class="line">        <span class="keyword">if</span>(type.InputReverse == TRUE)</span><br><span class="line">            data = reverse8(data);        <span class="comment">//字节反转</span></span><br><span class="line">        crc = crc ^ data;                <span class="comment">//与crc初始值异或</span></span><br><span class="line">           <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(crc &amp; <span class="number">0x80</span>)                <span class="comment">//左移移出的位为1,左移后与多项式异或</span></span><br><span class="line">                crc = (crc &lt;&lt; <span class="number">1</span>) ^ type.poly;</span><br><span class="line">            <span class="keyword">else</span>                         <span class="comment">//否则直接左移</span></span><br><span class="line">                crc &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(type.OutputReverse == TRUE)        <span class="comment">//满足条件,反转</span></span><br><span class="line">        crc = reverse8(crc);            </span><br><span class="line">    crc = crc ^ type.xor;                <span class="comment">//最后返与结果异或值异或</span></span><br><span class="line">    <span class="keyword">return</span> (crc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>显示-数码管流水</title>
      <link href="/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%95%B0%E7%A0%81%E7%AE%A1%E6%B5%81%E6%B0%B4/"/>
      <url>/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%95%B0%E7%A0%81%E7%AE%A1%E6%B5%81%E6%B0%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="显示-数码管流水"><a href="#显示-数码管流水" class="headerlink" title="显示-数码管流水"></a>显示-数码管流水</h1><h2 id="1-C语言版本"><a href="#1-C语言版本" class="headerlink" title="1.C语言版本"></a>1.C语言版本</h2><h3 id="1-1-4位数码管流水"><a href="#1-1-4位数码管流水" class="headerlink" title="1.1 4位数码管流水"></a>1.1 4位数码管流水</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">functio:</span></span><br><span class="line"><span class="comment">input: </span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">********************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __WATER_RUN__</span></span><br><span class="line"></span><br><span class="line">uchar run_speed,run_state;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">dsp_water_run</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(++run_speed &gt;= <span class="number">5</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        run_speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(++run_state &gt; <span class="number">11</span>) run_state = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dspbuf0 = dspbuf1 = dspbuf2 = dspbuf3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(run_state)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: &#123;dspbuf0 = dspbuf1 = dspbuf2 = seg_a; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: &#123;dspbuf1 = dspbuf2 = dspbuf3 = seg_a; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: &#123;dspbuf2 = dspbuf3 = seg_a; dspbuf3+=seg_b; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: &#123;dspbuf3 = seg_a+seg_b+seg_c; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: &#123;dspbuf3 = seg_b+seg_c+seg_d; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: &#123;dspbuf3 = seg_c+seg_d; dspbuf2 = seg_d; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: &#123;dspbuf3 = seg_d; dspbuf2 = dspbuf1 = seg_d; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>: &#123;dspbuf2 = dspbuf1 = dspbuf0 = seg_d; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>: &#123;dspbuf1 = dspbuf0 = seg_d; dspbuf0 += seg_e; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>: &#123;dspbuf0 = seg_d+seg_e+seg_f; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>: &#123;dspbuf0 = seg_e+seg_f+seg_a; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>: &#123;dspbuf0 = seg_f+seg_a; dspbuf1 = seg_a; <span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">default</span>:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="2-汇编版本"><a href="#2-汇编版本" class="headerlink" title="2.汇编版本"></a>2.汇编版本</h2><h3 id="2-1-4位数码管"><a href="#2-1-4位数码管" class="headerlink" title="2.1 4位数码管"></a>2.1 4位数码管</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">IFDEF     __KEY_STOP__</span><br><span class="line"></span><br><span class="line">dd_stop:</span><br><span class="line">        set        ststop</span><br><span class="line"> IFDEF __DSP_STOP__</span><br><span class="line">        mov        a,sym_5</span><br><span class="line">        mov        dspbuf0,a </span><br><span class="line">        mov        a,sym_t</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        mov        a,sym_0</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        mov        a,sym_p</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">    ENDIF</span><br><span class="line"></span><br><span class="line">IFDEF __WATER_RUN__        </span><br><span class="line">        inc        run_speed</span><br><span class="line">        mov        a,run_speed</span><br><span class="line">        sub        a,5</span><br><span class="line">        snz        c</span><br><span class="line">        jmp        _DD_RUN_1</span><br><span class="line">        clr        run_speed</span><br><span class="line"></span><br><span class="line">        mov        a,run_state</span><br><span class="line">        sub        a,12</span><br><span class="line">        sz        c</span><br><span class="line">        clr        run_state</span><br><span class="line">        inc        run_state</span><br><span class="line"></span><br><span class="line">_DD_RUN_1:        </span><br><span class="line">        clr        dspbuf0</span><br><span class="line">        clr        dspbuf1</span><br><span class="line">        clr        dspbuf2</span><br><span class="line">        clr        dspbuf3</span><br><span class="line"></span><br><span class="line">        mov        a,run_state</span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n2</span><br><span class="line">Dwr_n1:</span><br><span class="line">        mov        a,seg_a</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n2:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n3    </span><br><span class="line">        mov        a,seg_a</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n3:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n4        </span><br><span class="line">        mov        a,seg_a</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        add        a,seg_b</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n4:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n5</span><br><span class="line">        mov        a,seg_a+seg_b+seg_c</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret    </span><br><span class="line">Dwr_n5:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n6        </span><br><span class="line">        mov        a,seg_b+seg_c+seg_d</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret    </span><br><span class="line">Dwr_n6:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n7        </span><br><span class="line">        mov        a,seg_d</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        add        a,seg_c</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret    </span><br><span class="line">Dwr_n7:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n8        </span><br><span class="line">        mov        a,seg_d</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        mov        dspbuf3,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n8:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n9        </span><br><span class="line">        mov        a,seg_d</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        mov        dspbuf2,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n9:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n10        </span><br><span class="line">        mov        a,seg_d</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        add        a,seg_e</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n10:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n11        </span><br><span class="line">        mov        a,seg_d+seg_e+seg_f</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n11:        </span><br><span class="line">        sdz        acc</span><br><span class="line">        jmp        Dwr_n12        </span><br><span class="line">        mov        a,seg_e+seg_f+seg_a</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        ret</span><br><span class="line">Dwr_n12:        </span><br><span class="line">        mov        a,seg_a</span><br><span class="line">        mov        dspbuf1,a</span><br><span class="line">        add        a,seg_f</span><br><span class="line">        mov        dspbuf0,a</span><br><span class="line">        ret</span><br><span class="line">ENDIF</span><br><span class="line"></span><br><span class="line">        ret</span><br><span class="line">ENDIF</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
            <tag> 汇编 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>显示-正扫</title>
      <link href="/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%AD%A3%E6%89%AB/"/>
      <url>/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%AD%A3%E6%89%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="显示-正扫"><a href="#显示-正扫" class="headerlink" title="显示-正扫"></a>显示-正扫</h1><p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/%E5%8E%9F%E7%90%86%E5%9B%BE_%E7%81%AF1.png"></p><p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/%E5%8E%9F%E7%90%86%E5%9B%BE_%E6%95%B0%E7%A0%81%E7%AE%A11.png"></p><h2 id="1-定义com口与SEG口"><a href="#1-定义com口与SEG口" class="headerlink" title="1.定义com口与SEG口"></a>1.定义com口与SEG口</h2><p>在H文件中，先对涉及到的io口进行定义命名</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DRIVE_LED__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DRIVE_LED__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;def.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _Brightness        8 <span class="comment">//(6~40)</span></span></span><br><span class="line"><span class="comment">/* ************************************************* */</span></span><br><span class="line"><span class="comment">/* ************************************************* */</span></span><br><span class="line">uchar dd_buff[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Scan_Bit</span><span class="params">(uchar dat)</span>;</span><br><span class="line"><span class="type">void</span> __LED_drv();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//IO口选择</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> __DRIVE_LED_M0__</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_0         TRISC1 <span class="comment">//12脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_1         TRISC3 <span class="comment">//10脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_2         TRISC4 <span class="comment">//9脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_3         TRISD2 <span class="comment">//3脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_4         TRISC0 <span class="comment">//13脚</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_a         TRISA0 <span class="comment">//14脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_b         TRISC5 <span class="comment">//8脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_c         TRISB1 <span class="comment">//23脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_d         TRISC7 <span class="comment">//6脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_e         TRISC6 <span class="comment">//7脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_f         TRISC2 <span class="comment">//11脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_g         TRISB2 <span class="comment">//24脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_h         TRISB0 <span class="comment">//22脚-</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_0          RC1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_1          RC3</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_2          RC4</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_3          RD2</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_4          RC0</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_a          RA0</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_b          RC5</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_c          RB1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_d          RC7</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_e          RC6</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_f          RC2</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_g          RB2</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_h          RB0</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">ifdef</span> __DRIVE_LED_M1__</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_0         TRISC1 <span class="comment">//12脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_1         TRISC2 <span class="comment">//11脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_2         TRISC3 <span class="comment">//10脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_3         TRISC0 <span class="comment">//13脚</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_com_4         TRISC4 <span class="comment">//9脚</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_a         TRISA3 <span class="comment">//17脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_b         TRISA1 <span class="comment">//15脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_c         TRISA7 <span class="comment">//21脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_d         TRISA5 <span class="comment">//19脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_e         TRISA4 <span class="comment">//18脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_f         TRISA2 <span class="comment">//16脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_g         TRISA0 <span class="comment">//14脚-</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_seg_h         TRISA6 <span class="comment">//20脚-</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_0          RC1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_1          RC2</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_2          RC3</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_3          RC0</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_com_4          RC4</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_a          RA3</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_b          RA1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_c          RA7</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_d          RA5</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_e          RA4</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_f          RA2</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_g          RA0</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_seg_h          RA6</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//__DRIVE_LED__</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************************/</span></span><br><span class="line"><span class="comment">/************************************************************/</span></span><br><span class="line"><span class="comment">/************************************************************/</span></span><br><span class="line"><span class="comment">/*************************** For Example ********************/</span></span><br><span class="line"><span class="comment">/************************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************************/</span></span><br></pre></td></tr></table></figure><h2 id="2-正扫"><a href="#2-正扫" class="headerlink" title="2.正扫"></a>2.正扫</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">    functio:void Scan_Bit(uchar dat) </span></span><br><span class="line"><span class="comment">    input: </span></span><br><span class="line"><span class="comment">    output:</span></span><br><span class="line"><span class="comment">    ********************************************/</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">Scan_Bit</span><span class="params">(uchar dat)</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit0) &#123;pc_seg_a = <span class="number">0</span>;p_seg_a = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit1) &#123;pc_seg_b = <span class="number">0</span>;p_seg_b = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit2) &#123;pc_seg_c = <span class="number">0</span>;p_seg_c = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit3) &#123;pc_seg_d = <span class="number">0</span>;p_seg_d = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit4) &#123;pc_seg_e = <span class="number">0</span>;p_seg_e = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit5) &#123;pc_seg_f = <span class="number">0</span>;p_seg_f = <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit6) &#123;pc_seg_g = <span class="number">0</span>;p_seg_g = <span class="number">1</span>;&#125; </span><br><span class="line">        <span class="keyword">if</span>(dat&amp;bit7) &#123;pc_seg_h = <span class="number">0</span>;p_seg_h = <span class="number">1</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">    functio:void __LED_drv() 扫描数码管和LED</span></span><br><span class="line"><span class="comment">    input: </span></span><br><span class="line"><span class="comment">    output:</span></span><br><span class="line"><span class="comment">    ********************************************/</span></span><br><span class="line">    <span class="type">void</span> __LED_drv()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">static</span> uchar scan_cnt;</span><br><span class="line">        uchar i;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(b_led_next)</span><br><span class="line">        &#123;</span><br><span class="line">            b_led_next = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; _DSPBUFF_NUMBER; i++) &#123;dd_buff[i] = cms_dspbuff[i];&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(++scan_cnt &gt;= _Brightness) scan_cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//所有显示清0</span></span><br><span class="line">        p_com_0 = p_com_1 = p_com_2 = p_com_3 = p_com_4 = <span class="number">1</span>;</span><br><span class="line">        p_seg_a = p_seg_b = p_seg_c = p_seg_d = p_seg_e = p_seg_f = p_seg_g = p_seg_h = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (scan_cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:&#123;Scan_Bit(dd_buff[<span class="number">0</span>]);pc_com_0 = <span class="number">0</span>;p_com_0 = <span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:&#123;Scan_Bit(dd_buff[<span class="number">1</span>]);pc_com_1 = <span class="number">0</span>;p_com_1 = <span class="number">0</span>;<span class="keyword">break</span>;&#125;            </span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:&#123;Scan_Bit(dd_buff[<span class="number">2</span>]);pc_com_2 = <span class="number">0</span>;p_com_2 = <span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:&#123;Scan_Bit(dd_buff[<span class="number">3</span>]);pc_com_3 = <span class="number">0</span>;p_com_3 = <span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:&#123;Scan_Bit(dd_buff[<span class="number">4</span>]);pc_com_4 = <span class="number">0</span>;p_com_4 = <span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span> <span class="comment">//---__DRIVE_LED__---</span></span></span><br><span class="line"><span class="comment">//---__DRIVE_LED_SELECT__---</span></span><br></pre></td></tr></table></figure><h2 id="3-在中断中调用"><a href="#3-在中断中调用" class="headerlink" title="3.在中断中调用"></a>3.在中断中调用</h2><p>在125us中断处</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//125us处</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> __DRIVE_LED_SELECT__</span></span><br><span class="line">        <span class="keyword">if</span>(++sys_1ms_cnt &gt;= <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sys_1ms_cnt = <span class="number">0</span>;</span><br><span class="line">            __LED_drv();</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>在main()主函数中</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(b_sys_2ms)</span><br><span class="line">    &#123;</span><br><span class="line">        b_sys_2ms = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(++main_20ms_cnt &gt;= <span class="number">10</span>) main_20ms_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (main_20ms_cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                DSP_PRO();    <span class="comment">//显示处理</span></span><br><span class="line">                b_led_next = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>显示-正反扫</title>
      <link href="/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%AD%A3%E5%8F%8D%E6%89%AB/"/>
      <url>/2022/07/12/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA-%E6%AD%A3%E5%8F%8D%E6%89%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="显示-正反扫"><a href="#显示-正反扫" class="headerlink" title="显示-正反扫"></a>显示-正反扫</h1><p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/%E5%8E%9F%E7%90%86%E5%9B%BE_%E7%81%AF2.png"></p><p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/%E5%8E%9F%E7%90%86%E5%9B%BE_%E6%95%B0%E7%A0%81%E7%AE%A12.png"></p><h2 id="1-定义com口与SEG口"><a href="#1-定义com口与SEG口" class="headerlink" title="1.定义com口与SEG口"></a>1.定义com口与SEG口</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">;;各个IO口定义-----------------</span><br><span class="line">p_com1        equ            pa1</span><br><span class="line">p_com2        equ            pa3</span><br><span class="line">p_com3        equ            pa4</span><br><span class="line">p_com4        equ            pa7</span><br><span class="line"></span><br><span class="line">pc_com1        equ            pac1</span><br><span class="line">pc_com2        equ            pac3</span><br><span class="line">pc_com3        equ            pac4</span><br><span class="line">pc_com4        equ            pac7</span><br><span class="line"></span><br><span class="line">p_seg_a        equ            pd7 ;;</span><br><span class="line">p_seg_b        equ            pd5 ;;</span><br><span class="line">p_seg_c        equ            pd3 ;; </span><br><span class="line">p_seg_d        equ            pd0 ;;</span><br><span class="line">p_seg_e        equ            pd1 ;;</span><br><span class="line">p_seg_f        equ            pd6 ;;</span><br><span class="line">p_seg_g        equ            pd4    ;; </span><br><span class="line">p_seg_h        equ            pd2</span><br><span class="line"></span><br><span class="line">pc_seg_a        equ        pdc7 ;;</span><br><span class="line">pc_seg_b        equ        pdc5 ;;</span><br><span class="line">pc_seg_c        equ        pdc3 ;; </span><br><span class="line">pc_seg_d        equ        pdc0 ;;</span><br><span class="line">pc_seg_e        equ        pdc1 ;;</span><br><span class="line">pc_seg_f        equ        pdc6 ;;</span><br><span class="line">pc_seg_g        equ        pdc4 ;; </span><br><span class="line">pc_seg_h        equ        pdc2</span><br></pre></td></tr></table></figure><h2 id="2-定义寄存器"><a href="#2-定义寄存器" class="headerlink" title="2.定义寄存器"></a>2.定义寄存器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">_DISP_BUF        db        8 dup(?)    ;;显示缓存</span><br><span class="line">dspbuf0        equ        _DISP_BUF[2]</span><br><span class="line">sdot0            equ        dspbuf0.2 </span><br><span class="line">dspbuf1        equ        _DISP_BUF[1]</span><br><span class="line">sdot1            equ        dspbuf1.2  </span><br><span class="line">dspbuf2        equ        _DISP_BUF[0]</span><br><span class="line">dspbuf3        equ        _DISP_BUF[3]</span><br><span class="line"></span><br><span class="line">ledbuf0        equ        _DISP_BUF[4]</span><br><span class="line">st_1            equ        ledbuf0.0    </span><br><span class="line">st_2            equ        ledbuf0.1</span><br><span class="line">st_3            equ        ledbuf0.2    </span><br><span class="line">st_4            equ        ledbuf0.3</span><br><span class="line">st_5            equ        ledbuf0.4</span><br><span class="line">st_6            equ        ledbuf0.5</span><br><span class="line">st_7            equ        ledbuf0.6</span><br><span class="line">st_8            equ        ledbuf0.7            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ledbuf1        equ        _DISP_BUF[5]</span><br><span class="line">st_9            equ        ledbuf1.0    </span><br><span class="line">st_10            equ        ledbuf1.1</span><br><span class="line">st_11            equ        ledbuf1.2    </span><br><span class="line">st_12            equ        ledbuf1.3</span><br><span class="line">st_13            equ        ledbuf1.4</span><br><span class="line">st_14            equ        ledbuf1.5</span><br><span class="line">st_15            equ        ledbuf1.6</span><br><span class="line">st_16            equ        ledbuf1.7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ledbuf2        equ        _DISP_BUF[6]</span><br><span class="line">st_17            equ        ledbuf2.0</span><br><span class="line">st_18            equ        ledbuf2.1</span><br><span class="line">st_19            equ        ledbuf2.2</span><br><span class="line">st_20            equ        ledbuf2.3</span><br><span class="line">st_21            equ        ledbuf2.4</span><br><span class="line">st_22            equ        ledbuf2.5</span><br><span class="line">st_23            equ        ledbuf2.6</span><br><span class="line">st_24            equ        ledbuf2.7</span><br><span class="line"></span><br><span class="line">ledbuf3        equ        _DISP_BUF[7]</span><br><span class="line">st_25            equ        ledbuf3.4</span><br><span class="line">st_26            equ        ledbuf3.5</span><br><span class="line">st_27            equ        ledbuf3.6</span><br><span class="line">st_28            equ        ledbuf3.7</span><br><span class="line">st_29            equ        ledbuf3.0</span><br><span class="line">st_30            equ        ledbuf3.1</span><br><span class="line">st_31            equ        ledbuf3.2</span><br><span class="line">st_32            equ        ledbuf3.3</span><br></pre></td></tr></table></figure><h2 id="3-在125us处调用"><a href="#3-在125us处调用" class="headerlink" title="3.在125us处调用"></a>3.在125us处调用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">timer_isr:                        </span><br><span class="line">            push</span><br><span class="line">            clr     ptmaf</span><br><span class="line">;;2ms        </span><br><span class="line">            inc         timer_cnt</span><br><span class="line">            mov         a,timer_cnt</span><br><span class="line">            sub         a,16</span><br><span class="line">            snz            c</span><br><span class="line">            jmp         led_start</span><br><span class="line">            clr         timer_cnt</span><br><span class="line">            set            f_2ms</span><br><span class="line"></span><br><span class="line">;;500MS</span><br><span class="line">            inc            t500msjs</span><br><span class="line">            mov         a,t500msjs</span><br><span class="line">            sub         a,250</span><br><span class="line">            snz            c</span><br><span class="line">            jmp         led_start</span><br><span class="line">            clr         t500msjs</span><br><span class="line">            set         f_500ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;=================显示扫描==============            </span><br><span class="line">led_start:</span><br><span class="line">            JMP         _BS84B08C_DRIVR_LED_START    ;;    //显示扫描</span><br><span class="line">_DRIVR_LED_RETURN:</span><br></pre></td></tr></table></figure><h2 id="4-正反扫"><a href="#4-正反扫" class="headerlink" title="4.正反扫"></a>4.正反扫</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>4.1清屏<br>数码管,led灯全部清0；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">;;***********************************************************</span><br><span class="line">;;*NAME:_BS84B08C_DRIVR_LED_START                                                     *</span><br><span class="line">;;*INPUT    :                                               *</span><br><span class="line">;;*OUTPUT   :                                               *</span><br><span class="line">;;*USED REG.:                                               *</span><br><span class="line">;;*FUNCTION :正反扫           </span><br><span class="line">;;COM:    PA1 PA3 PA4 PA7 </span><br><span class="line">;;SEG: PD1 PD0 PD2 PD3 PD4 PD5 PD6 PD7                                    *</span><br><span class="line">;;***********************************************************                </span><br><span class="line">_BS84B08C_DRIVR_LED_START:</span><br><span class="line"></span><br><span class="line">            SET     PDC</span><br><span class="line">            CLR     PD        ;;SEG口设为输入,低电平</span><br><span class="line"></span><br><span class="line">            SET        pc_com1</span><br><span class="line">            SET        pc_com2</span><br><span class="line">            SET        pc_com3</span><br><span class="line">            SET        pc_com4</span><br><span class="line"></span><br><span class="line">            CLR        p_com1</span><br><span class="line">            CLR        p_com2</span><br><span class="line">            CLR        p_com3</span><br><span class="line">            CLR        p_com4    ;;全部清0</span><br></pre></td></tr></table></figure><h3 id="4-2设置亮度"><a href="#4-2设置亮度" class="headerlink" title="4.2设置亮度"></a>4.2设置亮度</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    sz        _CHK_LEDF            ;;检查是否允许刷新</span><br><span class="line">    jmp     scan_end</span><br><span class="line"></span><br><span class="line">;;循环扫描</span><br><span class="line">    inc        led_scan_task</span><br><span class="line">    mov     a,led_scan_task</span><br><span class="line">    sub     a,12</span><br><span class="line">    snz        c</span><br><span class="line">    jmp     scan_buf_1</span><br><span class="line">    mov     a,led_scan_task</span><br><span class="line">    sub     a,30</span><br><span class="line">    snz        c</span><br><span class="line">    jmp     scan_end</span><br><span class="line">    clr     led_scan_task    ;;调节亮度</span><br></pre></td></tr></table></figure><h3 id="4-3扫描数码管"><a href="#4-3扫描数码管" class="headerlink" title="4.3扫描数码管"></a>4.3扫描数码管</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">scan_buf_1:</span><br><span class="line">            mov     a,led_scan_task</span><br><span class="line">            addm    a,pcl</span><br><span class="line">            ;;------------------;扫描数码管的4个com</span><br><span class="line">            jmp     scan_gr1_c</span><br><span class="line">            jmp     scan_gr2_c</span><br><span class="line">            jmp     scan_gr3_c</span><br><span class="line">            jmp     scan_gr4_c            </span><br><span class="line">            ;;------------------;扫描数码管的4个seg            </span><br><span class="line">            jmp     scan_seg1</span><br><span class="line">            jmp     scan_seg2</span><br><span class="line">            jmp     scan_seg3</span><br><span class="line">            jmp     scan_seg4</span><br><span class="line">            jmp     scan_seg5</span><br><span class="line">            jmp     scan_seg6</span><br><span class="line">            jmp     scan_seg7</span><br><span class="line">            jmp     scan_seg8</span><br><span class="line"></span><br><span class="line">scan_gr1_c:</span><br><span class="line">            mov     a,_DISP_BUF[0]</span><br><span class="line">            mov     mov_buf,a            </span><br><span class="line">            clr     pc_com1</span><br><span class="line">            clr     p_com1        ;共阴数码管            </span><br><span class="line">            cpla      mov_buf        ;;取反, 因为输出为0,输入为1</span><br><span class="line">            jmp     com_scan    </span><br><span class="line"></span><br><span class="line">scan_gr2_c:</span><br><span class="line">            mov     a,_DISP_BUF[1]</span><br><span class="line">            mov     mov_buf,a            </span><br><span class="line">            clr     pc_com2</span><br><span class="line">            clr     p_com2        ;;共阴数码管            </span><br><span class="line">            cpla      mov_buf        ;;共阴数码管, 取反, 因为输出为0,输入为1</span><br><span class="line">            jmp     com_scan</span><br><span class="line"></span><br><span class="line">scan_gr3_c:</span><br><span class="line">            mov     a,_DISP_BUF[2]</span><br><span class="line">            mov     mov_buf,a            </span><br><span class="line">            clr     pc_com3</span><br><span class="line">            clr     p_com3        ;;共阴数码管            </span><br><span class="line">            cpla      mov_buf        ;;取反, 因为输出为0,输入为1</span><br><span class="line">            jmp     com_scan</span><br><span class="line"></span><br><span class="line">scan_gr4_c:</span><br><span class="line">            mov     a,_DISP_BUF[3]</span><br><span class="line">            mov     mov_buf,a            </span><br><span class="line">            clr     pc_com4</span><br><span class="line">            clr     p_com4        ;;共阴数码管            </span><br><span class="line">            cpla      mov_buf        ;;取反, 因为输出为0,输入为1</span><br><span class="line">            jmp     com_scan            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scan_seg1:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].0</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].0</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].0</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].0</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_d</span><br><span class="line">            clr     p_seg_d</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scan_seg2:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].1</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].1</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].1</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].1</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_e</span><br><span class="line">            clr     p_seg_e</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg3:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].2</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].2</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].2</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].2</span><br><span class="line">            or        a,00001000b        </span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_h</span><br><span class="line">            clr     p_seg_h</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg4:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].3</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].3</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].3</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].3</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_c</span><br><span class="line">            clr     p_seg_c</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg5:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].4</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].4</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].4</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].4</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_g</span><br><span class="line">            clr     p_seg_g</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg6:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].5</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].5</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].5</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].5</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_b</span><br><span class="line">            clr     p_seg_b</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg7:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].6</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].6</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].6</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].6</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_f</span><br><span class="line">            clr     p_seg_f</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_seg8:</span><br><span class="line">            clr     acc</span><br><span class="line">            sz        _DISP_BUF[4].7</span><br><span class="line">            or        a,00000001b</span><br><span class="line">            sz        _DISP_BUF[5].7</span><br><span class="line">            or        a,00000010b</span><br><span class="line">            sz        _DISP_BUF[6].7</span><br><span class="line">            or        a,00000100b</span><br><span class="line">            sz        _DISP_BUF[7].7</span><br><span class="line">            or        a,00001000b</span><br><span class="line">            mov     mov_buf,a</span><br><span class="line"></span><br><span class="line">            sz        mov_buf</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     seg_scan</span><br><span class="line">            clr     pc_seg_a</span><br><span class="line">            clr     p_seg_a</span><br><span class="line">            jmp     seg_scan</span><br><span class="line"></span><br><span class="line">scan_end:</span><br><span class="line">            JMP     _DRIVR_LED_RETURN            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;;共阴扫描</span><br><span class="line">com_scan:</span><br><span class="line">            mov     pdc,a        ;;输入为1    输出为0</span><br><span class="line">            mov        a,0ffh</span><br><span class="line">            mov     pd,a        ;;高电平1    低电平0</span><br><span class="line">            jmp     scan_end    ;;亮: 输出高电平</span><br><span class="line"></span><br><span class="line">;;共阳扫描</span><br><span class="line">seg_scan:</span><br><span class="line">            mov     a,mov_buf</span><br><span class="line">            sub     a,0</span><br><span class="line">            sz        c</span><br><span class="line">            jmp     $+2</span><br><span class="line">            jmp     scan_end    ;;无需点亮</span><br><span class="line"></span><br><span class="line">            snz        mov_buf.0</span><br><span class="line">            jmp     $+3</span><br><span class="line">            clr     pc_com1</span><br><span class="line">            set     p_com1</span><br><span class="line"></span><br><span class="line">            snz        mov_buf.1</span><br><span class="line">            jmp     $+3</span><br><span class="line">            clr     pc_com2</span><br><span class="line">            set     p_com2</span><br><span class="line"></span><br><span class="line">            snz        mov_buf.2</span><br><span class="line">            jmp     $+3</span><br><span class="line">            clr     pc_com3</span><br><span class="line">            set     p_com3</span><br><span class="line"></span><br><span class="line">            snz        mov_buf.3</span><br><span class="line">            jmp     $+3</span><br><span class="line">            clr     pc_com4</span><br><span class="line">            set     p_com4</span><br><span class="line"></span><br><span class="line">            jmp     scan_end    ;;亮:输出低电平</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>显示芯片-1628</title>
      <link href="/2022/07/06/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA%E8%8A%AF%E7%89%87-1628/"/>
      <url>/2022/07/06/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E6%98%BE%E7%A4%BA%E8%8A%AF%E7%89%87-1628/</url>
      
        <content type="html"><![CDATA[<h1 id="显示-1628"><a href="#显示-1628" class="headerlink" title="显示-1628"></a>显示-1628</h1><h2 id="1-定义与声明"><a href="#1-定义与声明" class="headerlink" title="1.定义与声明"></a>1.定义与声明</h2><p>在1628.h文件中，需要对IO口的名称，NOP的名称，再一次命名，还需要对函数进行声明。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _1628_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _1628_H_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------NOP定义----------------</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Nop()      &#123;GCC_NOP();&#125; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------1628  I/O口 ----------------------</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pc_dat      _pbc4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_clk       _pb3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_dat       _pb4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_stb       _pb0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数声明</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Write_Byte</span><span class="params">(uchar dat)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Drv</span><span class="params">(uchar Brightness)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Key</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> buff_num    7       <span class="comment">//</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _KEY_ONTIME 15      <span class="comment">//削抖时间 2ms * n</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="2-显示函数与按键函数"><a href="#2-显示函数与按键函数" class="headerlink" title="2.显示函数与按键函数"></a>2.显示函数与按键函数</h2><p>定义IO口</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span>  <span class="string">&quot;Include.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_clk_clr    p_clk=0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_clk_set    p_clk=1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_dat_clr    p_dat=0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_dat_set    p_dat=1 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_stb_clr    p_stb=0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_stb_set    p_stb=1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pc_dat_clr    pc_dat=0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pc_dat_set    pc_dat=1  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">volatile</span> uchar </span><br><span class="line">keydat1,</span><br><span class="line">keydat1bk,</span><br><span class="line">key_ontime</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Tm1628_Write_Byte(uchar dat)</span></span><br><span class="line"><span class="comment">输入:dat</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:1628写数据驱动(8位)</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Write_Byte</span><span class="params">(uchar dat)</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; <span class="number">8</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        p_clk_clr;</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        <span class="keyword">if</span>(dat &amp; <span class="number">0x01</span>)</span><br><span class="line">            p_dat_set;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p_dat_clr;</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        Nop();</span><br><span class="line">        dat&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        p_clk_set;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Tm1628_Drv()</span></span><br><span class="line"><span class="comment">输入:dat</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:1628写显示驱动</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Drv</span><span class="params">(uchar Brightness)</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    p_stb_clr;</span><br><span class="line">    pc_dat_clr;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Tm1628_Write_Byte(<span class="number">0x03</span>);</span><br><span class="line">    p_stb_set;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    p_stb_clr;</span><br><span class="line">    Tm1628_Write_Byte(<span class="number">0x40</span>);    <span class="comment">//地址自动增加</span></span><br><span class="line">    p_stb_set;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    p_stb_clr;</span><br><span class="line">    Tm1628_Write_Byte(<span class="number">0xc0</span>);    <span class="comment">//开显示</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; buff_num; i++)</span><br><span class="line">    &#123;    </span><br><span class="line">        Tm1628_Write_Byte(dsp_buff_TM[i]);</span><br><span class="line">        Tm1628_Write_Byte(<span class="number">0x0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p_stb_set;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    p_stb_clr;</span><br><span class="line">    Tm1628_Write_Byte(Brightness);</span><br><span class="line">    p_stb_set;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Tm1628_Key()</span></span><br><span class="line"><span class="comment">输入:dat</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:1628扫描按键</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tm1628_Key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i,j,temp;</span><br><span class="line">    p_stb_clr;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Tm1628_Write_Byte(<span class="number">0x42</span>);</span><br><span class="line">    pc_dat_set;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    keydat1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            temp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            p_clk_set;</span><br><span class="line">            Nop();</span><br><span class="line">            Nop();</span><br><span class="line">            Nop();</span><br><span class="line">            p_clk_clr;</span><br><span class="line">            Nop();</span><br><span class="line">            Nop();</span><br><span class="line">            Nop();</span><br><span class="line">            <span class="keyword">if</span>(p_dat) temp |= <span class="number">0x80</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// keydat[j] = temp;</span></span><br><span class="line">        <span class="keyword">if</span>(temp)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(temp &amp; <span class="number">0x01</span>) <span class="keyword">break</span>;</span><br><span class="line">                temp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            keydat1 = j*<span class="number">5</span>+i+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pc_dat_clr;</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    Nop();</span><br><span class="line">    p_dat_set;</span><br><span class="line">    p_stb_set;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----削抖过程----</span></span><br><span class="line">    <span class="keyword">if</span>(keydat1 == keydat1bk)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(key_ontime &gt; <span class="number">15</span>)  &#123;keydat_ =  keydat1;&#125;</span><br><span class="line">        <span class="keyword">else</span>  &#123;key_ontime++;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        keydat1bk = keydat1;</span><br><span class="line">        key_ontime = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-在主函数中调用"><a href="#3-在主函数中调用" class="headerlink" title="3.在主函数中调用"></a>3.在主函数中调用</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span>  <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_sys_2ms)</span><br><span class="line">    &#123;</span><br><span class="line">        b_sys_2ms = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(++main_20ms_cnt &gt;= <span class="number">10</span>) main_20ms_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (main_20ms_cnt)</span><br><span class="line">        &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">#<span class="keyword">ifdef</span> __DRIVE_TM1628_KEY__</span></span><br><span class="line">            Key_Pro(Keydat);</span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">break</span>;    </span><br><span class="line">        &#125;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="meta">#<span class="keyword">ifdef</span> __DRIVE_TM1628_SELECT__</span></span><br><span class="line">                Tm1628_Drv(<span class="number">0x8a</span>);    <span class="comment">//1628</span></span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span>                </span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        ...    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AD检测——笔记1</title>
      <link href="/2022/06/23/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/AD%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B01/"/>
      <url>/2022/06/23/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/AD%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<h1 id="AD检测——笔记1"><a href="#AD检测——笔记1" class="headerlink" title="AD检测——笔记1"></a>AD检测——笔记1</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>本次AD检测，采用常规的AD检测电路，使用单电阻分压，优点是电路和程序相对简单，缺点是对于个别的温度段分辨率不高，因此只适合对温度显示要求不高的场合。</p><h2 id="2-电路介绍"><a href="#2-电路介绍" class="headerlink" title="2.电路介绍"></a>2.电路介绍</h2><img src="https://raw.githubusercontent.com/chenborong/image/master/img/AD%E6%A3%80%E6%B5%8B_%E5%9B%BE1.jpg" alt="" width="314" height="439" class="jop-noMdConv"><p>如图所示，电路采用2.7K下拉，分压后使用104电容滤波储能，之所以使用2.7K，因为本次AD读取要求的从0~460F华氏度，范围较广，因此使用2.7K电阻</p><h2 id="3-真值表"><a href="#3-真值表" class="headerlink" title="3.真值表"></a>3.真值表</h2><p>在写程序之前，还需要通过传感器的真值表，结合下来2.7K电阻，计算出各个温度的AD值，结合使用的单片机，选择8位AD或者12位AD，这里使用的是12位AD。</p><p>以3950为例，在excel中，先列出每个温度点的电阻值，12位的AD计算公式为：1023&#x2F;(R(temp)+2.7)*2.7 而8位的AD计算公式为：255&#x2F;(R(temp)+2.7)*2.7</p><p>得到没一个华氏度对应的AD之后，则可以开始准备写程序</p><h2 id="4-软件部分"><a href="#4-软件部分" class="headerlink" title="4.软件部分"></a>4.软件部分</h2><h3 id="4-1在adc-h文件出，定义所需要的的寄存器"><a href="#4-1在adc-h文件出，定义所需要的的寄存器" class="headerlink" title="4.1在adc.h文件出，定义所需要的的寄存器"></a>4.1在adc.h文件出，定义所需要的的寄存器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uint TEMP_MAIN2,Temper;</span><br><span class="line">uint Loop_Arr;</span><br><span class="line">uchar adc_cnt;</span><br><span class="line"><span class="type">static</span> bit b_Adc;</span><br></pre></td></tr></table></figure><h3 id="4-2函数定义，以及AD表格"><a href="#4-2函数定义，以及AD表格" class="headerlink" title="4.2函数定义，以及AD表格"></a>4.2函数定义，以及AD表格</h3><p>在adc.c文件中，函数定义以及2.7K下拉电阻的AD表格(在3.真值表)中已有介绍</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ADC_CONVERSION</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">uint <span class="title function_">AD_Conbert</span><span class="params">(uchar ch_way)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Get_Temper</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//0~460F的AD表格</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> Tab_temp_array[]=&#123;</span><br><span class="line">    <span class="number">13</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">17</span>,    <span class="comment">//0~9F</span></span><br><span class="line">    <span class="number">18</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">22</span>,    <span class="comment">//10~19F</span></span><br><span class="line">    <span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,    <span class="comment">//20F~29F    </span></span><br><span class="line">    <span class="number">32</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">40</span>,    <span class="comment">//30~39F</span></span><br><span class="line">    <span class="number">42</span>,<span class="number">43</span>,<span class="number">44</span>,<span class="number">45</span>,<span class="number">46</span>,<span class="number">47</span>,<span class="number">48</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">53</span>,    <span class="comment">//40~49F</span></span><br><span class="line">    <span class="number">55</span>,<span class="number">56</span>,<span class="number">57</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">63</span>,<span class="number">65</span>,<span class="number">67</span>,<span class="number">69</span>,<span class="number">71</span>,    <span class="comment">//50F~59F</span></span><br><span class="line">    <span class="number">72</span>,<span class="number">73</span>,<span class="number">74</span>,<span class="number">76</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">83</span>,<span class="number">85</span>,<span class="number">87</span>,<span class="number">89</span>,    <span class="comment">//60~69F</span></span><br><span class="line">    <span class="number">92</span>,<span class="number">95</span>,<span class="number">97</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">105</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">114</span>,    <span class="comment">//70~79F</span></span><br><span class="line">    <span class="number">117</span>,<span class="number">119</span>,<span class="number">122</span>,<span class="number">125</span>,<span class="number">127</span>,<span class="number">130</span>,<span class="number">135</span>,<span class="number">138</span>,<span class="number">141</span>,<span class="number">144</span>,    <span class="comment">//80~89F</span></span><br><span class="line">    <span class="number">147</span>,<span class="number">150</span>,<span class="number">153</span>,<span class="number">156</span>,<span class="number">160</span>,<span class="number">163</span>,<span class="number">166</span>,<span class="number">170</span>,<span class="number">173</span>,<span class="number">179</span>,    <span class="comment">//90~99F</span></span><br><span class="line">    <span class="number">181</span>,<span class="number">183</span>,<span class="number">190</span>,<span class="number">195</span>,<span class="number">198</span>,<span class="number">201</span>,<span class="number">206</span>,<span class="number">210</span>,<span class="number">214</span>,<span class="number">222</span>,    <span class="comment">//100~109F</span></span><br><span class="line">    <span class="number">227</span>,<span class="number">230</span>,<span class="number">234</span>,<span class="number">239</span>,<span class="number">244</span>,<span class="number">248</span>,<span class="number">252</span>,<span class="number">257</span>,<span class="number">267</span>,<span class="number">271</span>,    <span class="comment">//110~119F</span></span><br><span class="line">    <span class="number">276</span>,<span class="number">280</span>,<span class="number">287</span>,<span class="number">292</span>,<span class="number">297</span>,<span class="number">303</span>,<span class="number">308</span>,<span class="number">318</span>,<span class="number">324</span>,<span class="number">330</span>,    <span class="comment">//120~129F</span></span><br><span class="line">    <span class="number">336</span>,<span class="number">341</span>,<span class="number">347</span>,<span class="number">353</span>,<span class="number">358</span>,<span class="number">365</span>,<span class="number">377</span>,<span class="number">387</span>,<span class="number">390</span>,<span class="number">397</span>,    <span class="comment">//130~139F</span></span><br><span class="line">    <span class="number">403</span>,<span class="number">410</span>,<span class="number">417</span>,<span class="number">423</span>,<span class="number">430</span>,<span class="number">444</span>,<span class="number">451</span>,<span class="number">459</span>,<span class="number">463</span>,<span class="number">473</span>,    <span class="comment">//140~149F</span></span><br><span class="line">    <span class="number">480</span>,<span class="number">488</span>,<span class="number">495</span>,<span class="number">504</span>,<span class="number">519</span>,<span class="number">527</span>,<span class="number">535</span>,<span class="number">542</span>,<span class="number">552</span>,<span class="number">560</span>,    <span class="comment">//150~159F</span></span><br><span class="line">    <span class="number">568</span>,<span class="number">576</span>,<span class="number">585</span>,<span class="number">603</span>,<span class="number">614</span>,<span class="number">620</span>,<span class="number">629</span>,<span class="number">638</span>,<span class="number">648</span>,<span class="number">656</span>,    <span class="comment">//160~169F</span></span><br><span class="line">    <span class="number">675</span>,<span class="number">685</span>,<span class="number">694</span>,<span class="number">703</span>,<span class="number">713</span>,<span class="number">723</span>,<span class="number">733</span>,<span class="number">743</span>,<span class="number">753</span>,<span class="number">763</span>,    <span class="comment">//170~179F</span></span><br><span class="line">    <span class="number">773</span>,<span class="number">794</span>,<span class="number">805</span>,<span class="number">815</span>,<span class="number">825</span>,<span class="number">836</span>,<span class="number">846</span>,<span class="number">858</span>,<span class="number">868</span>,<span class="number">879</span>,    <span class="comment">//180~189F</span></span><br><span class="line">    <span class="number">901</span>,<span class="number">912</span>,<span class="number">924</span>,<span class="number">936</span>,<span class="number">947</span>,<span class="number">960</span>,<span class="number">970</span>,<span class="number">984</span>,<span class="number">994</span>,<span class="number">1016</span>,    <span class="comment">//190~199F</span></span><br><span class="line">    <span class="number">1028</span>,<span class="number">1040</span>,<span class="number">1052</span>,<span class="number">1064</span>,<span class="number">1075</span>,<span class="number">1088</span>,<span class="number">1004</span>,<span class="number">1020</span>,<span class="number">1137</span>,<span class="number">1150</span>,    <span class="comment">//200~209F</span></span><br><span class="line">    <span class="number">1162</span>,<span class="number">1173</span>,<span class="number">1188</span>,<span class="number">1199</span>,<span class="number">1214</span>,<span class="number">1238</span>,<span class="number">1249</span>,<span class="number">1264</span>,<span class="number">1277</span>,<span class="number">1290</span>,    <span class="comment">//210~219F</span></span><br><span class="line">    <span class="number">1298</span>,<span class="number">1316</span>,<span class="number">1342</span>,<span class="number">1356</span>,<span class="number">1369</span>,<span class="number">1381</span>,<span class="number">1395</span>,<span class="number">1410</span>,<span class="number">1422</span>,<span class="number">1432</span>,    <span class="comment">//220~229F</span></span><br><span class="line">    <span class="number">1449</span>,<span class="number">1476</span>,<span class="number">1489</span>,<span class="number">1500</span>,<span class="number">1515</span>,<span class="number">1530</span>,<span class="number">1445</span>,<span class="number">1557</span>,<span class="number">1468</span>,<span class="number">1584</span>,    <span class="comment">//230~239F</span></span><br><span class="line">    <span class="number">1611</span>,<span class="number">1625</span>,<span class="number">1638</span>,<span class="number">1651</span>,<span class="number">1666</span>,<span class="number">1679</span>,<span class="number">1693</span>,<span class="number">1704</span>,<span class="number">1720</span>,<span class="number">1735</span>,    <span class="comment">//240~249F</span></span><br><span class="line">    <span class="number">1748</span>,<span class="number">1765</span>,<span class="number">1778</span>,<span class="number">1802</span>,<span class="number">1817</span>,<span class="number">1830</span>,<span class="number">1845</span>,<span class="number">1857</span>,<span class="number">1868</span>,<span class="number">1886</span>,    <span class="comment">//250~259F</span></span><br><span class="line">    <span class="number">1911</span>,<span class="number">1925</span>,<span class="number">1938</span>,<span class="number">1950</span>,<span class="number">1965</span>,<span class="number">1977</span>,<span class="number">1992</span>,<span class="number">2010</span>,<span class="number">2019</span>,<span class="number">2038</span>,    <span class="comment">//260~269F</span></span><br><span class="line">    <span class="number">2048</span>,<span class="number">2072</span>,<span class="number">2084</span>,<span class="number">2099</span>,<span class="number">2110</span>,<span class="number">2125</span>,<span class="number">2140</span>,<span class="number">2151</span>,<span class="number">2163</span>,<span class="number">2178</span>,    <span class="comment">//270~279F</span></span><br><span class="line">    <span class="number">2203</span>,<span class="number">2216</span>,<span class="number">2229</span>,<span class="number">2242</span>,<span class="number">2255</span>,<span class="number">2279</span>,<span class="number">2280</span>,<span class="number">2295</span>,<span class="number">2310</span>,<span class="number">2330</span>,    <span class="comment">//280~289F</span></span><br><span class="line">    <span class="number">2345</span>,<span class="number">2356</span>,<span class="number">2369</span>,<span class="number">2380</span>,<span class="number">2397</span>,<span class="number">2405</span>,<span class="number">2419</span>,<span class="number">2433</span>,<span class="number">2450</span>,<span class="number">2468</span>,     <span class="comment">//290~299F</span></span><br><span class="line">    <span class="number">2477</span>,<span class="number">2489</span>,<span class="number">2501</span>,<span class="number">2513</span>,<span class="number">2524</span>,<span class="number">2435</span>,<span class="number">2547</span>,<span class="number">2570</span>,<span class="number">2482</span>,<span class="number">2593</span>,     <span class="comment">//300~309F</span></span><br><span class="line">    <span class="number">2506</span>,<span class="number">2615</span>,<span class="number">2627</span>,<span class="number">2638</span>,<span class="number">2649</span>,<span class="number">2660</span>,<span class="number">2682</span>,<span class="number">2693</span>,<span class="number">2703</span>,<span class="number">2713</span>,    <span class="comment">//310~319F</span></span><br><span class="line">    <span class="number">2724</span>,<span class="number">2735</span>,<span class="number">2746</span>,<span class="number">2756</span>,<span class="number">2766</span>,<span class="number">2787</span>,<span class="number">2797</span>,<span class="number">2807</span>,<span class="number">2817</span>,<span class="number">2827</span>,    <span class="comment">//320~329F</span></span><br><span class="line">    <span class="number">2837</span>,<span class="number">2847</span>,<span class="number">2857</span>,<span class="number">2867</span>,<span class="number">2886</span>,<span class="number">2897</span>,<span class="number">2905</span>,<span class="number">2914</span>,<span class="number">2924</span>,<span class="number">2933</span>,    <span class="comment">//330~339F</span></span><br><span class="line">    <span class="number">2942</span>,<span class="number">2951</span>,<span class="number">2961</span>,<span class="number">2979</span>,<span class="number">2988</span>,<span class="number">2997</span>,<span class="number">3002</span>,<span class="number">3014</span>,<span class="number">3022</span>,<span class="number">3032</span>,    <span class="comment">//340~349F    </span></span><br><span class="line">    <span class="number">3040</span>,<span class="number">3049</span>,<span class="number">3065</span>,<span class="number">3073</span>,<span class="number">3082</span>,<span class="number">3090</span>,<span class="number">3098</span>,<span class="number">3007</span>,<span class="number">3114</span>,<span class="number">3125</span>,    <span class="comment">//350~359F</span></span><br><span class="line">    <span class="number">3130</span>,<span class="number">3146</span>,<span class="number">3154</span>,<span class="number">3161</span>,<span class="number">3168</span>,<span class="number">3176</span>,<span class="number">3184</span>,<span class="number">3191</span>,<span class="number">3198</span>,<span class="number">3206</span>,    <span class="comment">//360~369F    </span></span><br><span class="line">    <span class="number">3220</span>,<span class="number">3228</span>,<span class="number">3235</span>,<span class="number">3241</span>,<span class="number">3249</span>,<span class="number">3256</span>,<span class="number">3262</span>,<span class="number">3269</span>,<span class="number">3276</span>,<span class="number">3289</span>,    <span class="comment">//370~379F    </span></span><br><span class="line">    <span class="number">3396</span>,<span class="number">3303</span>,<span class="number">3309</span>,<span class="number">3315</span>,<span class="number">3322</span>,<span class="number">3328</span>,<span class="number">3336</span>,<span class="number">3341</span>,<span class="number">3353</span>,<span class="number">3359</span>,    <span class="comment">//380~389F</span></span><br><span class="line">    <span class="number">3365</span>,<span class="number">3371</span>,<span class="number">3377</span>,<span class="number">3382</span>,<span class="number">3389</span>,<span class="number">3395</span>,<span class="number">3400</span>,<span class="number">3412</span>,<span class="number">3417</span>,<span class="number">3423</span>,    <span class="comment">//390~399F</span></span><br><span class="line">    <span class="number">3429</span>,<span class="number">3434</span>,<span class="number">3439</span>,<span class="number">3444</span>,<span class="number">3449</span>,<span class="number">3455</span>,<span class="number">3466</span>,<span class="number">3471</span>,<span class="number">3476</span>,<span class="number">3481</span>,    <span class="comment">//400~409F</span></span><br><span class="line">    <span class="number">3486</span>,<span class="number">3491</span>,<span class="number">3496</span>,<span class="number">3500</span>,<span class="number">3505</span>,<span class="number">3515</span>,<span class="number">3520</span>,<span class="number">3524</span>,<span class="number">3529</span>,<span class="number">3534</span>,    <span class="comment">//410~419F</span></span><br><span class="line">    <span class="number">3539</span>,<span class="number">3543</span>,<span class="number">3548</span>,<span class="number">3551</span>,<span class="number">3560</span>,<span class="number">3564</span>,<span class="number">3569</span>,<span class="number">3574</span>,<span class="number">3577</span>,<span class="number">3582</span>,    <span class="comment">//420~429F</span></span><br><span class="line">    <span class="number">3586</span>,<span class="number">3590</span>,<span class="number">3594</span>,<span class="number">3602</span>,<span class="number">3606</span>,<span class="number">3610</span>,<span class="number">3614</span>,<span class="number">3617</span>,<span class="number">3621</span>,<span class="number">3625</span>,    <span class="comment">//430~439F</span></span><br><span class="line">    <span class="number">3629</span>,<span class="number">3633</span>,<span class="number">3640</span>,<span class="number">3644</span>,<span class="number">3647</span>,<span class="number">3650</span>,<span class="number">3654</span>,<span class="number">3658</span>,<span class="number">3661</span>,<span class="number">3665</span>,    <span class="comment">//440~449F</span></span><br><span class="line">    <span class="number">3668</span>,<span class="number">3675</span>,<span class="number">3678</span>,<span class="number">3681</span>,<span class="number">3685</span>,<span class="number">3688</span>,<span class="number">3691</span>,<span class="number">3694</span>,<span class="number">3698</span>,<span class="number">3701</span>,    <span class="comment">//450~459F</span></span><br><span class="line">    <span class="number">3707</span>,<span class="number">3707</span>,</span><br><span class="line">    &#125;;    <span class="comment">//460F</span></span><br></pre></td></tr></table></figure><h3 id="4-3AD转换，得到12位AD"><a href="#4-3AD转换，得到12位AD" class="headerlink" title="4.3AD转换，得到12位AD"></a>4.3AD转换，得到12位AD</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:uchar AD_Conbert(uchar ch_way)</span></span><br><span class="line"><span class="comment">输入:AD通道</span></span><br><span class="line"><span class="comment">输出:_sadoh _sadol(12位)</span></span><br><span class="line"><span class="comment">函数功能：AD转换,输入通道,返回AD值的高8位</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line">uint <span class="title function_">AD_Conbert</span><span class="params">(uchar ch_way)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint main_12 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    _sadc0 = ch_way;</span><br><span class="line">    _start = <span class="number">0</span>;</span><br><span class="line">    GCC_NOP();</span><br><span class="line">    _start = <span class="number">1</span>;</span><br><span class="line">    GCC_NOP();</span><br><span class="line">    _start = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (_adbz);</span><br><span class="line">    main_12 = _sadoh;</span><br><span class="line">    main_12 &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">    main_12 |= _sadol;</span><br><span class="line">    main_12 &gt;&gt;= <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> main_12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4削抖，滤波"><a href="#4-4削抖，滤波" class="headerlink" title="4.4削抖，滤波"></a>4.4削抖，滤波</h3><p>经过累计求平均的方法，去除最值，削抖，可以得到相对稳定的AD值</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:void Get_Temper()</span></span><br><span class="line"><span class="comment">输入:</span></span><br><span class="line"><span class="comment">输出:Temper</span></span><br><span class="line"><span class="comment">函数功能：将12位AD值，转化成华氏度(F)</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Get_Temper</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    <span class="comment">//获取AD完毕</span></span><br><span class="line">    <span class="keyword">if</span>(b_Adc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(TEMP_MAIN2 &gt;= <span class="number">3707</span>) &#123;Temper = <span class="number">460</span>;b_Adc = <span class="number">0</span>;&#125;    <span class="comment">//短路,显示460F</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(TEMP_MAIN2 &lt;= <span class="number">20</span>) &#123;Temper = <span class="number">20</span>;b_Adc = <span class="number">0</span>;&#125;    <span class="comment">//开路,显示20F</span></span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt;= <span class="number">20</span>;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(TEMP_MAIN2 &lt;= Tab_temp_array[Loop_Arr])    </span><br><span class="line">                &#123;</span><br><span class="line">                        Temper = Loop_Arr;            <span class="comment">//Temper 为实际的温度</span></span><br><span class="line">                        Loop_Arr = <span class="number">460</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++Loop_Arr &gt;= <span class="number">461</span>)    <span class="comment">//超过表格</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(Loop_Arr &gt;= <span class="number">460</span>) &#123;b_Adc = <span class="number">0</span>;&#125;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5主函数调用"><a href="#4-5主函数调用" class="headerlink" title="4.5主函数调用"></a>4.5主函数调用</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    。。。</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(b_sys_2ms)</span><br><span class="line">    &#123;</span><br><span class="line">        b_sys_2ms = <span class="number">0</span>;</span><br><span class="line">        ADC_CONVERSION();    <span class="comment">//得到12位AD值</span></span><br><span class="line">        Get_Temper();        <span class="comment">//将AD转换成实际温度值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>蜂鸣器</title>
      <link href="/2022/06/17/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E8%9C%82%E9%B8%A3%E5%99%A8/"/>
      <url>/2022/06/17/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E8%9C%82%E9%B8%A3%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="蜂鸣器"><a href="#蜂鸣器" class="headerlink" title="蜂鸣器"></a>蜂鸣器</h1><p>无源蜂鸣器，需要使用8K的振荡频率的脉冲驱动，才能发出声音。根据频率的大小，决定蜂鸣器叫声的尖锐程度。</p><p>在单片机中，需要先配置125us的定时器中断，蜂鸣器对应的单片机引脚，输出脉冲，即可驱动蜂鸣器</p><h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><h3 id="定义寄存器"><a href="#定义寄存器" class="headerlink" title="定义寄存器"></a>定义寄存器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uchar        Buze_Step=<span class="number">0</span>;</span><br><span class="line">uchar        Buze_Cnt_Time=<span class="number">0</span>;</span><br><span class="line">uchar        Buze_Off=<span class="number">0</span>;</span><br><span class="line">uchar        Buze_On=<span class="number">0</span>;</span><br><span class="line">uchar        Buze_Set_Cnt=<span class="number">0</span>;</span><br></pre></td></tr></table></figure><h3 id="在125us中断中"><a href="#在125us中断中" class="headerlink" title="在125us中断中"></a>在125us中断中</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=========================</span></span><br><span class="line"><span class="comment">//位置:125us中断处</span></span><br><span class="line"><span class="comment">//=========================</span></span><br><span class="line"><span class="type">void</span>    <span class="title function_">Buze_Driver</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//蜂鸣器驱动</span></span><br><span class="line">    <span class="keyword">if</span>(bBuze)             </span><br><span class="line">        BUZE ^= <span class="number">1</span> ;        <span class="comment">//异或运算，不停取反</span></span><br><span class="line">    <span class="keyword">else</span>    </span><br><span class="line">        BUZE = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在10ms或者20ms处"><a href="#在10ms或者20ms处" class="headerlink" title="在10ms或者20ms处"></a>在10ms或者20ms处</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=========================</span></span><br><span class="line"><span class="comment">//位置:主函数,每10ms或者20ms进来一次</span></span><br><span class="line"><span class="comment">//蜂鸣器控制</span></span><br><span class="line"><span class="comment">//=========================</span></span><br><span class="line"><span class="type">void</span>    <span class="title function_">Buze_Control</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="comment">//发声的时候关闭，蜂鸣器</span></span><br><span class="line">    <span class="keyword">if</span> (bEnable_Buze)</span><br><span class="line">    &#123;        </span><br><span class="line">        ++Buze_Cnt_Time;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span>==Buze_Step)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Buze_Cnt_Time&lt;Buze_On)&#123;bBuze=<span class="number">1</span>;&#125;            </span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;                </span><br><span class="line">                bBuze=<span class="number">0</span>;</span><br><span class="line">                Buze_Cnt_Time=<span class="number">0</span>;</span><br><span class="line">                Buze_Step=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">1</span>==Buze_Step)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Buze_Cnt_Time&lt;Buze_Off) bBuze=<span class="number">0</span>;         </span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Buze_Step=<span class="number">0</span>;</span><br><span class="line">                Buze_Cnt_Time=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (Buze_Set_Cnt&gt;<span class="number">0</span>) --Buze_Set_Cnt;                    </span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span>==Buze_Set_Cnt)&#123;bEnable_Buze = bSet_Buze = <span class="number">0</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在需要蜂鸣器叫的地方，调用以下函数"><a href="#在需要蜂鸣器叫的地方，调用以下函数" class="headerlink" title="在需要蜂鸣器叫的地方，调用以下函数"></a>在需要蜂鸣器叫的地方，调用以下函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================</span></span><br><span class="line"><span class="comment">//位置:按键处理,或者功能处,</span></span><br><span class="line"><span class="comment">//Buze_OnTime,发声时间;</span></span><br><span class="line"><span class="comment">//BuzeOffTime,毕声时间;</span></span><br><span class="line"><span class="comment">//Buze_Cnt,发声次数</span></span><br><span class="line"><span class="comment">//Buze_Set(150,0,1);</span></span><br><span class="line"><span class="comment">//=====================================</span></span><br><span class="line"><span class="type">void</span>    <span class="title function_">Buze_Set</span><span class="params">(u16  Buze_OnTime, u16  BuzeOffTime,u8 Buze_Cnt)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!bSet_Buze)       </span><br><span class="line">    &#123;</span><br><span class="line">        bSet_Buze=<span class="number">1</span>;</span><br><span class="line">        Buze_On = Buze_OnTime/<span class="number">10</span>;</span><br><span class="line">        Buze_Off = BuzeOffTime/<span class="number">10</span>;</span><br><span class="line">        Buze_Set_Cnt = Buze_Cnt;</span><br><span class="line">        Buze_Step = <span class="number">0</span>;    </span><br><span class="line">        Buze_Cnt_Time=<span class="number">0</span>;</span><br><span class="line">        bEnable_Buze=<span class="number">1</span>;        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><h3 id="定义寄存器-1"><a href="#定义寄存器-1" class="headerlink" title="定义寄存器"></a>定义寄存器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bit b_beep_on,b_fan_on;</span><br><span class="line">uchar beep_count0;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************</span></span><br><span class="line"><span class="comment">*******************蜂鸣器-风扇********************</span></span><br><span class="line"><span class="comment">*************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pc_buz_fan      TRISA6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> p_buz_fan       RB6</span></span><br></pre></td></tr></table></figure><h3 id="125us处"><a href="#125us处" class="headerlink" title="125us处"></a>125us处</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//========================================= </span></span><br><span class="line"><span class="comment">//========蜂鸣器与风扇======================</span></span><br><span class="line">        <span class="keyword">if</span>(b_beep_on) &#123;p_buz_fan ^= <span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(b_fan_on) &#123;p_buz_fan = <span class="number">1</span>;&#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;p_buz_fan = <span class="number">0</span>;&#125;</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure><h3 id="在20ms处"><a href="#在20ms处" class="headerlink" title="在20ms处"></a>在20ms处</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment">函数名称:Beep_Pro()</span></span><br><span class="line"><span class="comment">输入:无</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能：蜂鸣器函数 20ms/次</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Beep_Pro</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(beep_count0) beep_count0--;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        beep_count0 = <span class="number">0</span>;</span><br><span class="line">        b_beep_on = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在需要调用的地方"><a href="#在需要调用的地方" class="headerlink" title="在需要调用的地方"></a>在需要调用的地方</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************</span></span><br><span class="line"><span class="comment"> 函数名称:Beep_Inin()</span></span><br><span class="line"><span class="comment">输入:无</span></span><br><span class="line"><span class="comment">输出:无</span></span><br><span class="line"><span class="comment">函数功能:风扇-蜂鸣器初始化</span></span><br><span class="line"><span class="comment">*****************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Beep_Init</span><span class="params">(uchar _BLONG)</span></span><br><span class="line">&#123;</span><br><span class="line">    b_beep_on = <span class="number">1</span>;</span><br><span class="line">    b_fan_on = <span class="number">0</span>;</span><br><span class="line">    beep_count0 = _BLONG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编码器</title>
      <link href="/2022/06/17/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E7%BC%96%E7%A0%81%E5%99%A8/"/>
      <url>/2022/06/17/Hugo%20Blog/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/%E7%BC%96%E7%A0%81%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h1><p><img src="https://raw.githubusercontent.com/chenborong/image/master/img/202206171701526.jpg"></p><h2 id="c语言版本"><a href="#c语言版本" class="headerlink" title="c语言版本"></a>c语言版本</h2><h3 id="在H文件中-定义相关寄存器"><a href="#在H文件中-定义相关寄存器" class="headerlink" title="在H文件中,定义相关寄存器"></a>在H文件中,定义相关寄存器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************************************************</span></span><br><span class="line"><span class="comment">function:旋钮处理</span></span><br><span class="line"><span class="comment">input:</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">**************************************************/</span></span><br><span class="line"><span class="comment">/**************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __ECONDERSWITCH__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __ECONDERSWITCH__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;def.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*EncoderSwitch编码器*************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined (__ENCODERSWITCH_M0__)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderA      RB1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderB      RB2</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderA     TRISB1 </span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderB     TRISB2</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined (__ENCODERSWITCH_M1__)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderA      RD1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderB      RD2</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderA     TRISD1 </span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderB     TRISD2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined (__ENCODERSWITCH_M2__)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderA      RA6</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> p_encoderB      RA7</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderA     TRISA6 </span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> pc_encoderB     TRISA7</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">uchar </span><br><span class="line">Encod_state_cnt,</span><br><span class="line">Encod_State_bak,</span><br><span class="line">Encod_State_Temp,</span><br><span class="line">Encod_State_Last,</span><br><span class="line">Encod_State_Left,</span><br><span class="line">Encod_State_Right,</span><br><span class="line">Encod_RL</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">bit </span><br><span class="line">b_Right,</span><br><span class="line">b_Left</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">uchar <span class="title function_">EncoderScan</span><span class="params">(uchar __TURN_CHANGE)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">EncoderSwitchProcess</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="在main-c文件中，调用旋钮函数"><a href="#在main-c文件中，调用旋钮函数" class="headerlink" title="在main.c文件中，调用旋钮函数"></a>在main.c文件中，调用旋钮函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">functio:uchar EncoderScan(uchar __TURN_CHANGE) </span></span><br><span class="line"><span class="comment">input: </span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">********************************************/</span></span><br><span class="line">uchar <span class="title function_">EncoderScan</span><span class="params">(uchar __TURN_CHANGE)</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar Encod_state = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//IO口的状态</span></span><br><span class="line">    <span class="keyword">if</span>(Encod_RL &lt; ESP_CHANGE) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(p_encoderA) &#123;Encod_state |= <span class="number">0x01</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(p_encoderB) &#123;Encod_state |= <span class="number">0x02</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//削抖,电平削抖</span></span><br><span class="line">    <span class="keyword">if</span>(Encod_State_bak == Encod_state)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Encod_state_cnt &lt; __TURN_CHANGE) &#123;Encod_state_cnt++; <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        Encod_State_bak = Encod_state;</span><br><span class="line">        Encod_state_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    Encod_State_Temp = Encod_State_Last;    <span class="comment">//上次状态:Encod_State_Temp</span></span><br><span class="line">    Encod_State_Last = Encod_state;         <span class="comment">//这次状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0x03</span> == Encod_state) &#123;b_Right = b_Left = <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0x03</span> == Encod_State_Temp)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0x01</span> == Encod_state) &#123;b_Right = <span class="number">1</span>;b_Left = <span class="number">0</span>;&#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;b_Right = <span class="number">0</span>;b_Left = <span class="number">1</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0x00</span> == Encod_State_Temp)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0x02</span> == Encod_state) &#123;<span class="keyword">if</span>(b_Right) &#123;Encod_RL = <span class="number">0</span>;<span class="keyword">return</span> <span class="number">1</span>;&#125;&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0x01</span> == Encod_state) &#123;<span class="keyword">if</span>(b_Left) &#123;Encod_RL = <span class="number">0</span>;<span class="keyword">return</span> <span class="number">2</span>;&#125;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在10ms或者20ms处"><a href="#在10ms或者20ms处" class="headerlink" title="在10ms或者20ms处"></a>在10ms或者20ms处</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">EncoderSwitchProcess</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Encod_RL &lt; ESP_CHANGE)   Encod_RL++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************/</span></span><br><span class="line"><span class="comment">/********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> __ENCODER_SWITCH__</span></span><br><span class="line">        i = EncoderScan(TURN_CHANGE);</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>) key_add(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">2</span>) key_sub(<span class="number">1</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(++main_20ms_cnt&gt;=<span class="number">10</span>) main_20ms_cnt=<span class="number">0</span>;    </span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (main_20ms_cnt)</span><br><span class="line">            &#123;</span><br><span class="line">                ...</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    EncoderSwitchProcess();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合泰汇编版本"><a href="#合泰汇编版本" class="headerlink" title="合泰汇编版本"></a>合泰汇编版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">#define p_bm1        pb.3</span><br><span class="line">#define p_bm2        pb.4</span><br><span class="line"></span><br><span class="line">temp7        db    ?</span><br><span class="line">temp7_bit0     equ   temp7.0</span><br><span class="line">temp7_bit1     equ   temp7.1</span><br><span class="line"></span><br><span class="line">prestatus        db        ?</span><br><span class="line">Econd_Cnt        db        ?</span><br><span class="line">updatejs        db        ?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CHK_Encode:</span><br><span class="line">        sz        berror</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        sz            block</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        snz            bonoff</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        nop</span><br><span class="line">        nop</span><br><span class="line">        set     pbc.3</span><br><span class="line">        set     pbc.4 </span><br><span class="line">        nop </span><br><span class="line">        nop </span><br><span class="line">        nop</span><br><span class="line">        nop</span><br><span class="line">        clr     temp7</span><br><span class="line">        nop</span><br><span class="line">        nop</span><br><span class="line">        sz         p_bm1</span><br><span class="line">        set     temp7_bit0</span><br><span class="line"></span><br><span class="line">        sz         p_bm2</span><br><span class="line">        set     temp7_bit1</span><br><span class="line"></span><br><span class="line">        mov     a,prestatus</span><br><span class="line">        sub     a,temp7</span><br><span class="line">        snz        z</span><br><span class="line">        jmp     Update_statu</span><br><span class="line"></span><br><span class="line">;;消抖</span><br><span class="line">        mov     a,Econd_Cnt</span><br><span class="line">        sub     a,25</span><br><span class="line">        sz        c</span><br><span class="line">        jmp     CHK_Statu    </span><br><span class="line">        inc     Econd_Cnt</span><br><span class="line">        ret         </span><br><span class="line"></span><br><span class="line">Update_statu:</span><br><span class="line">        clr     Econd_Cnt</span><br><span class="line">        mov     a,temp7</span><br><span class="line">        mov     prestatus,a</span><br><span class="line">        ret        </span><br><span class="line"></span><br><span class="line">CHK_Statu:</span><br><span class="line"></span><br><span class="line">        mov     a,statu_1</span><br><span class="line">        mov     statu_2,a        ;;上次状态</span><br><span class="line"></span><br><span class="line">        mov     a,prestatus</span><br><span class="line">        mov     statu_1,a            ;;这次状态</span><br><span class="line"></span><br><span class="line">        mov     a,prestatus    </span><br><span class="line">        sub     a,03h</span><br><span class="line">        snz        z</span><br><span class="line">        jmp     $+4</span><br><span class="line"></span><br><span class="line">        clr     b_left </span><br><span class="line">        clr     b_right</span><br><span class="line">        ret </span><br><span class="line"></span><br><span class="line">        mov     a,statu_2</span><br><span class="line">        sub     a,03h</span><br><span class="line">        snz        z</span><br><span class="line">        jmp        CHK_2     </span><br><span class="line"></span><br><span class="line">CHK_1:</span><br><span class="line">        mov     a,statu_1</span><br><span class="line">        sub     a,01</span><br><span class="line">        snz        z</span><br><span class="line">        jmp     $+4</span><br><span class="line"></span><br><span class="line">        set     b_right</span><br><span class="line">        clr     b_left</span><br><span class="line">        ret </span><br><span class="line"></span><br><span class="line">        clr     b_right</span><br><span class="line">        set     b_left</span><br><span class="line">        ret </span><br><span class="line"></span><br><span class="line">CHK_2:        </span><br><span class="line">         mov     a,statu_2</span><br><span class="line">         sub     a,00h</span><br><span class="line">         snz     z</span><br><span class="line">         ret </span><br><span class="line"></span><br><span class="line">         mov     a,statu_1</span><br><span class="line">         sub     a,02h </span><br><span class="line">         sz         z</span><br><span class="line">         jmp     TURN_R</span><br><span class="line"></span><br><span class="line">         mov     a,statu_1</span><br><span class="line">         sub     a,01h </span><br><span class="line">         sz         z</span><br><span class="line">         jmp     TURN_L</span><br><span class="line"></span><br><span class="line">         ret </span><br><span class="line"></span><br><span class="line">TURN_R:</span><br><span class="line">         snz        b_right     </span><br><span class="line">         ret </span><br><span class="line">         call     key_sub</span><br><span class="line">         ret </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TURN_L:    </span><br><span class="line">        snz     b_left</span><br><span class="line">        ret </span><br><span class="line">        call     key_add </span><br><span class="line">        ret </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RET</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单片机函数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> 编码器 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
